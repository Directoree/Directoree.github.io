{"title":"CTF-SMB-Information-leakage","date":"2019-07-13T15:58:31.000Z","thumbnail":"https://i.loli.net/2019/07/13/5d28b0723b7ab75620.jpg","link":"post/CTF-SMB-Information-leakage","comments":true,"tags":["CTF","SMB"],"categories":["CTF"],"updated":"2019-07-15T16:48:00.788Z","content":"<p>(｡◕︎‿◕︎)ﾉﾟ･ﾟ･*</p>\n<a id=\"more\"></a>\n<hr>\n<h2 id=\"一、SMB-介绍\"><font color=\"#FF6347\" face=\"Comic sans MS\">一、SMB 介绍</font><a href=\"post/CTF-SMB-Information-leakage#一、SMB-介绍\"></a></h2><p>SMB (Server Message Block）通信协议是微软（Microsoft）和英特尔（Intel））在 1987 年制定的协议，主要是作为 Microsoft 网络的通讯协议。后来 Linux 移植了 SMB，并称为 <font color=\"#FF7F00\" size=\"4\"><strong>samba</strong></font>。</p>\n<p>SMB 协议是基于 TCP- NETBIOS 下的，一般端口使用为 <font color=\"#FF7F00\" size=\"4\"><strong>139,445</strong></font></p>\n<p>SMB 协议、计算机可以访问网络资源，下载对应的资源文件。</p>\n<h2 id=\"二、渗透测试\"><font color=\"#FF6347\" face=\"Comic sans MS\">二、渗透测试</font><a href=\"post/CTF-SMB-Information-leakage#二、渗透测试\"></a></h2><h3 id=\"2-1-信息探测\"><font color=\"#3CB371\" face=\"Comic sans MS\">2.1 信息探测</font><a href=\"post/CTF-SMB-Information-leakage#2-1-信息探测\"></a></h3><p>对于只是给定一个对应 P 地址的靶场机器，我们需要用对其进行扫描，探測开放的服务。</p>\n<p>渗透其实是针对服务的漏洞探测，然后进行对应的数据包发送，<strong>获取机器的最高权限</strong>。</p>\n<pre class=\"line-numbers language-c\"><code class=\"language-c\">nmap <span class=\"token operator\">-</span>sV IP        挖掘开放服务信息\nnmap <span class=\"token operator\">-</span>A <span class=\"token operator\">-</span>v <span class=\"token operator\">-</span>T4 IP   挖掘靶场全部信息 A：所有信息 v：把探测信息详细输出 <span class=\"token operator\">-</span>T4：nmap使用最大线程数，最快速<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h3 id=\"2-2-分析探测结果\"><font color=\"#3CB371\" face=\"Comic sans MS\">2.2 分析探测结果</font><a href=\"post/CTF-SMB-Information-leakage#2-2-分析探测结果\"></a></h3><p>每一个服务对应计算机的一个端口，用来进行通信。常用端口0~1023端口，在扫描结果中查找特殊端口，针对特殊端口进行探测，<strong>尤其对开发大端口的http服务进行排查</strong>;</p>\n<h3 id=\"2-3-针对-SMB-协议弱点分析\"><font color=\"#3CB371\" face=\"Comic sans MS\">2.3 针对 SMB 协议弱点分析</font><a href=\"post/CTF-SMB-Information-leakage#2-3-针对-SMB-协议弱点分析\"></a></h3><ol>\n<li>针对SMB协议使用空口令，若口令尝试合陆，并查看敏感文件，下载查看，使用如下命令<pre class=\"line-numbers language-c\"><code class=\"language-c\">smbclient <span class=\"token operator\">-</span>L IP\nsmbclient <span class=\"token string\">'\\\\IP\\$share'</span>\nget 敏感文件<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n扫描返回结果如下图<br><img src=\"https://i.loli.net/2019/07/13/5d29adcdbe71d72126.png\" alt=\"1\"><br><img src=\"https://i.loli.net/2019/07/13/5d29e401dce0463739.png\" alt=\"2\"><br>查看探测到的文件目录，并下载获取信息如下图<br><img src=\"https://i.loli.net/2019/07/13/5d29e4e87583381221.png\" alt=\"3\"><br>下载配置文件后查看，得到了数据库的配置信息包括数据库账户密码等，如下图<br><img src=\"https://i.loli.net/2019/07/16/5d2ca7c62034b76704.png\" alt=\"4\"></li>\n</ol>\n<p><strong>尝试利用一下</strong></p>\n<ul>\n<li>从刚才的扫描结果可以看到 3306 端口是已经打开了的，尝试远程登录MYSQL，使用命令<strong><code>mysql -h 192.168.253.17 -u 刚才获得的用户名 -p 刚才获得的密码</code></strong>，发现数据库关闭了远程登录，不能登录；</li>\n<li>尝试利用 22 端口的SSH协议登录，使用命令 <strong><code>ssh 用户名@服务器IP</code></strong>，然后输入密码然后发现密码错误，则22端口不能利用。</li>\n</ul>\n<ol start=\"2\">\n<li>针对 SMB 协议<strong>远程溢出漏洞</strong>进行分析<pre class=\"line-numbers language-c\"><code class=\"language-c\">searchsploit samba版本号<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n发现扫描出来的两个版本号都没有对应的漏洞。</li>\n</ol>\n<h3 id=\"2-4-针对HTTP协议弱点分析\"><font color=\"#3CB371\" face=\"Comic sans MS\">2.4 针对HTTP协议弱点分析</font><a href=\"post/CTF-SMB-Information-leakage#2-4-针对HTTP协议弱点分析\"></a></h3><ol>\n<li>浏览器查看网站;</li>\n<li>使用<code>dirb</code>、<code>nikto</code>探测;</li>\n<li>寻找突破点，目标登录后台，上传webshell;</li>\n</ol>\n<ol>\n<li>使用<strong>dirb</strong>扫描http协议下的远程服务器的目录文件，如下图<br><img src=\"https://i.loli.net/2019/07/16/5d2cac6be846593741.png\" alt=\"5\"><br>发现一个类似后台admin的一个链接，浏览器打开后发现确实是一个后台，然后使用前面在配置文件中得到的数据库用于名和密码尝试登陆，然后登陆成功了。<br>登陆后后台如下图<br><img src=\"https://i.loli.net/2019/07/16/5d2cad789acf043502.png\" alt=\"6\"><br>然后尝试看能不能利用上传webshell木马来提权，点击后台评论后发现，里面的内容可以编辑，则可以将webshell放到这里，然后远程监听就可以利用来提权了。</li>\n</ol>\n<h3 id=\"2-5-使用webshell提权\"><font color=\"#3CB371\" face=\"Comic sans MS\">2.5 使用webshell提权</font><a href=\"post/CTF-SMB-Information-leakage#2-5-使用webshell提权\"></a></h3>","next":{"title":"CTF-SSH服务渗透测试","link":"post/CTF-SSH-service-penetration"},"plink":"https://Directoree.github.io/post/CTF-SMB-Information-leakage/","toc":[{"title":"<font color=\"#FF6347\" face=\"Comic sans MS\">一、SMB 介绍</font>","id":"一、SMB-介绍","index":"1"},{"title":"<font color=\"#FF6347\" face=\"Comic sans MS\">二、渗透测试</font>","id":"二、渗透测试","index":"2","children":[{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">2.1 信息探测</font>","id":"2-1-信息探测","index":"2.1"},{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">2.2 分析探测结果</font>","id":"2-2-分析探测结果","index":"2.2"},{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">2.3 针对 SMB 协议弱点分析</font>","id":"2-3-针对-SMB-协议弱点分析","index":"2.3"},{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">2.4 针对HTTP协议弱点分析</font>","id":"2-4-针对HTTP协议弱点分析","index":"2.4"},{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">2.5 使用webshell提权</font>","id":"2-5-使用webshell提权","index":"2.5"}]}],"reward":true,"copyright":{"author":"Directoree","link":"<a href=\"https://Directoree.github.io/post/CTF-SMB-Information-leakage/\" title=\"CTF-SMB-Information-leakage\">https://Directoree.github.io/post/CTF-SMB-Information-leakage/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}