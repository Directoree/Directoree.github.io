<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon1.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"directoree.github.io","root":"/","scheme":"Mist","version":"8.0.0","exturl":false,"sidebar":{"position":"left","width":300,"display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="ğŸ˜„">
<meta property="og:type" content="article">
<meta property="og:title" content="x64 æ±‡ç¼–åŸºç¡€">
<meta property="og:url" content="https://directoree.github.io/post/x64-Disassembly2/index.html">
<meta property="og:site_name" content="Catecat">
<meta property="og:description" content="ğŸ˜„">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/10/19/UaKTG3kXQRfpnu5.png">
<meta property="og:image" content="https://s2.loli.net/2022/10/19/crasH9Yuk1dTtpb.png">
<meta property="og:image" content="https://s2.loli.net/2021/12/19/ySQIR7D1LpUgh3v.png">
<meta property="og:image" content="https://s2.loli.net/2022/10/20/xipeXTMdJuj1trK.png">
<meta property="og:image" content="https://s2.loli.net/2022/10/20/HbloO1uRwiaNLrV.png">
<meta property="og:image" content="https://s2.loli.net/2022/10/20/lxurpwdD5zV7I6t.png">
<meta property="og:image" content="https://s2.loli.net/2022/10/20/5NrYf29H6eqTlFG.png">
<meta property="og:image" content="https://s2.loli.net/2022/10/21/zkRAXMj547wSmY3.png">
<meta property="og:image" content="https://s2.loli.net/2022/10/21/JcjZklFoROsMVhm.png">
<meta property="og:image" content="https://s2.loli.net/2022/10/21/gjaq7AeTv6COWsF.png">
<meta property="og:image" content="https://s2.loli.net/2022/10/21/lSwWe6EZsJdIzqT.png">
<meta property="og:image" content="https://s2.loli.net/2022/11/07/YpqxNQCVhw1d3i6.png">
<meta property="og:image" content="https://s2.loli.net/2022/11/07/Hi53YJKFm6tWrg4.png">
<meta property="og:image" content="https://s2.loli.net/2022/11/07/hflDd8GQoc9FjeT.png">
<meta property="og:image" content="https://s2.loli.net/2022/11/07/5lZ3NiX7aMYocnR.png">
<meta property="og:image" content="https://s2.loli.net/2022/11/07/TB8coQxKuEnqVSg.png">
<meta property="og:image" content="https://s2.loli.net/2022/11/07/tKy1UdVubqxGJcZ.png">
<meta property="article:published_time" content="2022-10-21T11:07:41.000Z">
<meta property="article:modified_time" content="2022-11-07T13:19:16.673Z">
<meta property="article:author" content="Catecat">
<meta property="article:tag" content="Windowså†…æ ¸">
<meta property="article:tag" content="x64æ±‡ç¼–">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/10/19/UaKTG3kXQRfpnu5.png">


<link rel="canonical" href="https://directoree.github.io/post/x64-Disassembly2/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>x64 æ±‡ç¼–åŸºç¡€ | Catecat</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b832a9ae9a43377003fd975ca4e525ea";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Catecat</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">çˆ±ä½ æ‰€çˆ±ï¼Œè¡Œä½ æ‰€è¡Œï¼Œå¬ä»ä½ å¿ƒï¼Œæ— é—®è¥¿ä¸œã€‚</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/newcategories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-æ›´æ–°æ—¥å¿—">

    <a href="/changelog" rel="section"><i class="fa fa-heartbeat fa-fw"></i>æ›´æ–°æ—¥å¿—</a>

  </li>
        <li class="menu-item menu-item-ç©ºè°ƒæˆ¿">

    <a href="/tips" rel="section"><i class="fa fa-wifi fa-fw"></i>ç©ºè°ƒæˆ¿</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0-%E5%86%85%E6%A0%B8%E5%88%A9%E7%94%A8Github"><span class="nav-text">0 å†…æ ¸åˆ©ç”¨Github</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-VS%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96"><span class="nav-text">1 VSå†…è”æ±‡ç¼–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text">2 å¯„å­˜å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E9%80%9A%E7%94%A8%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%88GPRs%EF%BC%89"><span class="nav-text">2.1 é€šç”¨å¯„å­˜å™¨ï¼ˆGPRsï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%98%93%E5%A4%B1-x2F-%E9%9D%9E%E6%98%93%E5%A4%B1%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text">2.2 æ˜“å¤±&#x2F;éæ˜“å¤±å¯„å­˜å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-RFLAGS"><span class="nav-text">2.3 RFLAGS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%87%BD%E6%95%B0%E6%93%8D%E4%BD%9C"><span class="nav-text">3 å‡½æ•°æ“ä½œ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E8%B0%83%E7%94%A8%E7%BA%A6%E5%AE%9A"><span class="nav-text">3.1 è°ƒç”¨çº¦å®š</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%A0%86%E6%A0%88%E5%AF%B9%E9%BD%90"><span class="nav-text">3.2 å †æ ˆå¯¹é½</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-x64-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%A4%A7%E5%B0%8F"><span class="nav-text">3.3 x64 æ•°æ®ç±»å‹å¤§å°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E5%A0%86%E6%A0%88%E6%93%8D%E4%BD%9C"><span class="nav-text">3.4 å †æ ˆæ“ä½œ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E4%B8%AA%E5%8F%82%E6%95%B0Debug"><span class="nav-text">3ä¸ªå‚æ•°Debug</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E4%B8%AA%E5%8F%82%E6%95%B0Release"><span class="nav-text">3 ä¸ªå‚æ•°Release</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%E4%B8%AA%E5%8F%82%E6%95%B0Debug"><span class="nav-text">6ä¸ªå‚æ•°Debug</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%E4%B8%AA%E5%8F%82%E6%95%B0Release"><span class="nav-text">6ä¸ªå‚æ•°Release</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%85%B6%E4%BB%96%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="nav-text">4 å…¶ä»–çŸ¥è¯†ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-0-x64%E5%AF%84%E5%AD%98%E5%99%A8%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F"><span class="nav-text">4.0 x64å¯„å­˜å™¨ä½¿ç”¨æ³¨æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-ASCII"><span class="nav-text">4.1 ASCII</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%B0%8F%E7%AB%AF%E5%AD%98%E5%82%A8"><span class="nav-text">4.2 å°ç«¯å­˜å‚¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E6%B1%87%E7%BC%96%E7%BC%96%E8%AF%91%E5%99%A8"><span class="nav-text">4.3 æ±‡ç¼–ç¼–è¯‘å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E6%95%B4%E6%95%B0%E5%8F%96%E5%80%BC%E8%8C%83%E5%9B%B4"><span class="nav-text">4.4 æ•´æ•°å–å€¼èŒƒå›´</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-x64%E5%9C%B0%E5%9D%80%E8%8C%83%E5%9B%B4"><span class="nav-text">4.5 x64åœ°å€èŒƒå›´</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-%E7%BA%BF%E6%80%A7%E5%9C%B0%E5%9D%80"><span class="nav-text">4.6 çº¿æ€§åœ°å€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-7-RIP-Relative"><span class="nav-text">4.7 RIP-Relative</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-8-%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90"><span class="nav-text">4.8 å†…å­˜å¯¹é½</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-64-%E4%BD%8D%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="nav-text">5 64 ä½æ¨¡å¼çš„æŒ‡ä»¤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-0-REX-prefix"><span class="nav-text">5.0 REX prefix</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E6%93%8D%E4%BD%9C%E6%95%B0%E5%A4%A7%E5%B0%8F%EF%BC%88operand-Size%EF%BC%89"><span class="nav-text">5.1 æ“ä½œæ•°å¤§å°ï¼ˆoperand Sizeï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-64-%E4%BD%8D%E6%A8%A1%E5%BC%8F%E6%97%A0%E6%95%88%E6%8C%87%E4%BB%A4"><span class="nav-text">5.2 64 ä½æ¨¡å¼æ— æ•ˆæŒ‡ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E5%AF%BB%E5%9D%80%E5%9C%B0%E5%9D%80%E5%A4%A7%E5%B0%8F%EF%BC%88operand-address-size%EF%BC%89"><span class="nav-text">5.3 å¯»å€åœ°å€å¤§å°ï¼ˆoperand address sizeï¼‰</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Catecat"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Catecat</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">144</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/newcategories/">
          
        <span class="site-state-item-count">63</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">76</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Directoree" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;Directoree" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhao_yilong@aliyun.com" title="E-Mail â†’ mailto:zhao_yilong@aliyun.com" rel="noopener" target="_blank"><i class="fas fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://sighttp.qq.com/msgrd?v=1&uin=1003432683" title="QQ â†’ http:&#x2F;&#x2F;sighttp.qq.com&#x2F;msgrd?v&#x3D;1&amp;uin&#x3D;1003432683" rel="noopener" target="_blank"><i class="fab fa-qq fa-fw"></i>QQ</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://treecatee.github.io/" title="https:&#x2F;&#x2F;treecatee.github.io" rel="noopener" target="_blank">Treecatee</a>
        </li>
    </ul>
  </div>

      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://directoree.github.io/post/x64-Disassembly2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Catecat">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Catecat">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          x64 æ±‡ç¼–åŸºç¡€
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-10-21 19:07:41" itemprop="dateCreated datePublished" datetime="2022-10-21T19:07:41+08:00">2022-10-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">æ›´æ–°äº</span>
        <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-11-07 21:19:16" itemprop="dateModified" datetime="2022-11-07T21:19:16+08:00">2022-11-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/x64%E6%B1%87%E7%BC%96/" itemprop="url" rel="index"><span itemprop="name">x64æ±‡ç¼–</span></a>
        </span>
    </span>

  
    <span id="/post/x64-Disassembly2/" class="post-meta-item leancloud_visitors" data-flag-title="x64 æ±‡ç¼–åŸºç¡€" title="é˜…è¯»æ¬¡æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/post/x64-Disassembly2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/post/x64-Disassembly2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>16k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>15 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>ğŸ˜„</p>
<span id="more"></span>

<h2 id="0-å†…æ ¸åˆ©ç”¨Github"><a href="#0-å†…æ ¸åˆ©ç”¨Github" class="headerlink" title="0 å†…æ ¸åˆ©ç”¨Github"></a>0 å†…æ ¸åˆ©ç”¨Github</h2><p><a target="_blank" rel="noopener" href="https://github.com/ExpLife0011/awesome-windows-kernel-security-development">awesome-windows-kernel-security-development</a>ã€‚</p>
<h2 id="1-VSå†…è”æ±‡ç¼–"><a href="#1-VSå†…è”æ±‡ç¼–" class="headerlink" title="1 VSå†…è”æ±‡ç¼–"></a>1 VSå†…è”æ±‡ç¼–</h2><p>åœ¨ç¼–è¯‘ 32 ä½ç¨‹åºçš„æ—¶å€™ï¼Œç›´æ¥ <code>__asm</code> å†…è”æ±‡ç¼–å³å¯ä½¿ç”¨ï¼Œä½†æ˜¯å½“ç›®æ ‡å¹³å°ä¸º x64 æ—¶ï¼Œå¾®è½¯ä¸å†å…è®¸ç›´æ¥å†…è”æ±‡ç¼–äº†ï¼Œå¯é€šè¿‡åœ¨ 64 ä½ç¨‹åºä¸­å†…è”æ±‡ç¼–ä»£ç ã€‚</p>
<p>IDEï¼šVS 2019</p>
<p>OSï¼šWindows 10 21H2ï¼ˆ19044.2130ï¼‰</p>
<ol>
<li><p>åˆ›å»ºæ§åˆ¶å°é¡¹ç›®ã€‚</p>
</li>
<li><p><em>æºæ–‡ä»¶</em>å³é”®â€”<em>æ·»åŠ </em>â€”<em>æ–°å»ºé¡¹</em>â€”<em>C++æ–‡ä»¶</em>ï¼Œå‘½åä¸º <code>First_Inline_Asm.asm</code>ã€‚</p>
</li>
<li><p>åœ¨æºæ–‡ä»¶ <code>First_Inline_Asm.asm</code> å³é”®â€”<em>å±æ€§</em>â€”<em>é¡¹ç±»å‹</em>â€”<em>è‡ªå®šä¹‰ç”Ÿæˆå·¥å…·</em>â€”åº”ç”¨ï¼ˆç„¶åå±æ€§ä¸Šå°±å¤šå‡ºæ¥äº†â€œè‡ªå®šä¹‰ç”Ÿæˆå·¥å…·â€ï¼‰ã€‚</p>
</li>
<li><p>åœ¨ä¸Šä¸€æ­¥éª¤åŸºç¡€ä¸Šï¼Œ<em>è‡ªå®šä¹‰å¸¸è§„å·¥å…·</em>â€”<em>å¸¸è§„</em>â€”å‘½ä»¤è¡Œï¼š<code>ml64 /c %(filename).asm</code><em>ï¼›</em>è¾“å‡ºï¼š<code>%(filename).obj;%(Outputs)</code>ã€‚</p>
</li>
<li><p>åœ¨ä¸Šä¸€æ­¥éª¤åŸºç¡€ä¸Šï¼Œå¹³å°ï¼š<code>æ´»åŠ¨x64</code>ã€‚</p>
</li>
<li><p>æ±‡ç¼–æ–‡ä»¶çš„<em>é…ç½®å±æ€§</em>â€”<em>ä»ä¸­ç”Ÿæˆæ’é™¤ï¼šå¦</em>ã€‚</p>
</li>
<li><p><code>.asm</code> é‡Œé¢å‡½æ•°çš„å†™æ³•ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">; æŒ‡å®šä»£ç ç¼–è¯‘ï¼ˆå¯çœç•¥ï¼‰bit <span class="number">16</span>, bit <span class="number">32</span>, bit <span class="number">64</span> </span><br><span class="line">.CODE</span><br><span class="line">  </span><br><span class="line">GetPebLdr PROC</span><br><span class="line">	mov rax, gs:[<span class="number">60</span>h];</span><br><span class="line">	add rax, <span class="number">18</span>h;</span><br><span class="line">	mov rax, [rax];</span><br><span class="line">	ret;</span><br><span class="line">GetPebLdr ENDP</span><br><span class="line">  </span><br><span class="line">END</span><br></pre></td></tr></table></figure>


</li>
<li><p>åœ¨ä¸»æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>  <span class="function">ULONGLONG _fastcall <span class="title">GetPebLdr</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>æ³¨æ„è¿™ç§å†…è”æ±‡ç¼–<strong>æºæ“ä½œæ•°å¦‚æœæ˜¯åå…­è¿›åˆ¶æ•°</strong>ï¼Œå†™æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ï¼Œä¸è¯†åˆ« 0x</span></span><br><span class="line">mov rax, <span class="number">0xFFEEDDCC01234567</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯ï¼Œä¸è¯†åˆ« F</span></span><br><span class="line">mov rax, FFEEDDCC01234567h;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ­£ç¡®ï¼Œåœ¨åå…­è¿›åˆ¶æ•°å‰åŠ  0</span></span><br><span class="line">mov rax, <span class="number">0F</span>FEEDDCC01234567h;</span><br></pre></td></tr></table></figure>



<p>å®Œæ•´ Demoï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// First_Inline_Asm.asm</span></span><br><span class="line">.CODE</span><br><span class="line">  </span><br><span class="line">GetPebLdr PROC</span><br><span class="line">	mov rax, gs:[<span class="number">60</span>h];</span><br><span class="line">	add rax, <span class="number">18</span>h;</span><br><span class="line">	mov rax, [rax];</span><br><span class="line">	ret;</span><br><span class="line">GetPebLdr ENDP</span><br><span class="line">  </span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>  <span class="function">PVOID64 _fastcall <span class="title">GetPebLdr</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PVOID64 pRet = GetPebLdr();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>, pRet);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.kn0sky.com/?p=68">ä½¿ç”¨VS2019å†™64ä½å†…è”æ±‡ç¼–</a>ã€‚</p>
<h2 id="2-å¯„å­˜å™¨"><a href="#2-å¯„å­˜å™¨" class="headerlink" title="2 å¯„å­˜å™¨"></a>2 å¯„å­˜å™¨</h2><h3 id="2-1-é€šç”¨å¯„å­˜å™¨ï¼ˆGPRsï¼‰"><a href="#2-1-é€šç”¨å¯„å­˜å™¨ï¼ˆGPRsï¼‰" class="headerlink" title="2.1 é€šç”¨å¯„å­˜å™¨ï¼ˆGPRsï¼‰"></a>2.1 é€šç”¨å¯„å­˜å™¨ï¼ˆGPRsï¼‰</h3><p>x64 ä¸‹æŒ‡é’ˆå’Œåœ°å€éƒ½æ˜¯ 8 å­—èŠ‚ï¼ˆ64ä½ï¼‰ã€‚</p>
<ul>
<li>x64 å¢åŠ äº†8ä¸ªé€šç”¨å¯„å­˜å™¨ï¼šR8~R15ï¼Œå®ƒä»¬éƒ½æ˜¯64ä½çš„ã€‚</li>
<li>å¦å¤–è¿˜å¢åŠ äº† 8 ä¸ª 128 ä½ XMM å¯„å­˜å™¨ã€‚</li>
<li>64 ä½å¯„å­˜å™¨ä¸ x86 ä¸‹çš„ 32 ä½å¯„å­˜å™¨å…¼å®¹ï¼Œä¾‹å¦‚ RAXï¼ˆ64ä½ï¼‰ã€EAXï¼ˆä½32ï¼‰ã€AXï¼ˆä½16ä½ï¼‰ã€ALï¼ˆä½8ä½ï¼‰ã€AHï¼ˆ8åˆ°15ä½ï¼‰ï¼Œç›¸åº”çš„æœ‰R8ã€R8Dã€R8Wå’ŒR8Bã€‚</li>
<li>ä¸è¦åœ¨ç¨‹åºä¸­ä½¿ç”¨å¦‚ <code>AH</code> ä¹‹ç±»çš„å¯„å­˜å™¨ï¼Œå› ä¸ºåœ¨ AMD çš„ CPU ä¸Šè¿™ç§ç”¨æ³•ä¼šä¸æŸäº›æŒ‡ä»¤äº§ç”Ÿå†²çªã€‚</li>
</ul>
<p><img data-src="https://s2.loli.net/2022/10/19/UaKTG3kXQRfpnu5.png" alt="1.png"></p>
<p><img data-src="https://s2.loli.net/2022/10/19/crasH9Yuk1dTtpb.png" alt="2.png"></p>
<p>é€šç”¨å¯„å­˜å™¨ï¼ˆGeneral-Purpose Registers, GPRsï¼‰ï¼Œå‚è€ƒ Intel æ‰‹å†Œå· 1 3.4.1ã€‚</p>
<p>64 ä½é€šç”¨å¯„å­˜å™¨å…± 16 ä¸ªï¼ˆä¸åŒ…å« RIPï¼ŒRflagsï¼‰ã€‚åœ¨ x64 ä¸­å…³äº RSPã€RBPï¼š</p>
<ul>
<li><mark class="label warning">RSP</mark>  ï¼šç”¨æ¥è¿›è¡Œç›¸å¯¹å¯»å€ï¼ˆRIP-relative addressingï¼‰æ¥æ‰¾åˆ°å †æ ˆä¸Šçš„å‚æ•°ã€å±€éƒ¨å˜é‡ã€‚ä¸åƒ x86 åŸºäº EBP å¯»å€ã€‚</li>
<li><mark class="label success">RBP</mark>  ï¼šä»å¯åš Base Frame Pointï¼Œä½†æ˜¯å¸¸è¢«ç”¨æ¥å½“é€šç”¨å¯„å­˜å™¨ä½¿ç”¨ï¼ˆGPRsï¼‰ã€‚</li>
</ul>
<h3 id="2-2-æ˜“å¤±-x2F-éæ˜“å¤±å¯„å­˜å™¨"><a href="#2-2-æ˜“å¤±-x2F-éæ˜“å¤±å¯„å­˜å™¨" class="headerlink" title="2.2 æ˜“å¤±&#x2F;éæ˜“å¤±å¯„å­˜å™¨"></a>2.2 æ˜“å¤±&#x2F;éæ˜“å¤±å¯„å­˜å™¨</h3><p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/build/x64-software-conventions?view=msvc-170">æ˜“å¤±å¯„å­˜å™¨</a>æ˜¯ç”±è°ƒç”¨æ–¹å‡æƒ³çš„ä¸´æ—¶å¯„å­˜å™¨ï¼Œå¹¶è¦åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­é”€æ¯ã€‚ <strong>éæ˜“å¤±å¯„å­˜å™¨éœ€è¦åœ¨æ•´ä¸ªå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ä¿ç•™å…¶å€¼ï¼Œå¹¶ä¸”ä¸€æ—¦ä½¿ç”¨ï¼Œåˆ™å¿…é¡»ç”±è¢«è°ƒç”¨æ–¹ä¿å­˜</strong>ï¼ˆæ‰€ä»¥å¸¸ä¼šçœ‹åˆ°å †æ ˆä¸­ä¿å­˜ <code>rbp, rdi</code>ï¼‰ã€‚</p>
<ul>
<li>æ˜“å˜å¯„å­˜å™¨ï¼šRAX, RCX, RDX, R8-R11</li>
<li>éæ˜“å˜å¯„å­˜å™¨ï¼šRBP, RBX, RSI, RDI, R12-R15</li>
</ul>
<h3 id="2-3-RFLAGS"><a href="#2-3-RFLAGS" class="headerlink" title="2.3 RFLAGS"></a>2.3 RFLAGS</h3><p>åœ¨ x64 ä¸­ï¼Œå°† <code>EFLAGS</code> æ‰©å±•æˆ 64 ä½ï¼Œä½†æ˜¯é«˜ 32 ä½ä¿ç•™ã€‚æ‰€ä»¥å¯¹äº x64 æ¥è¯´ï¼Œ<code>RFLAGS</code> å’Œ <code>EFLAGS</code> æ˜¯ä¸€æ ·çš„ã€‚</p>
<p><code>RFLAGS</code> çš„ä½å—ç®—æœ¯&#x2F;é€»è¾‘è¿ç®—å½±å“ï¼ŒåŒæ—¶ <code>RFLAGS</code>  çš„ä½ä¹Ÿå½±å“ CPU çš„æ‰§è¡Œã€‚å¦‚ <code>TF</code> ç½®ä½æ—¶ CPU å•æ­¥è¿è¡Œã€‚</p>
<p>å…·ä½“æ ‡è¯†ä¸ºå¯çœ‹ <strong>Intel æ‰‹å†Œå· 1 3.4.3</strong> å’Œ <a target="_blank" rel="noopener" href="https://www.cnblogs.com/Reverse-xiaoyu/p/11397584.html">EFLAGSå¯„å­˜å™¨ï¼ˆæ ‡å¿—å¯„å­˜å™¨ï¼‰</a>ã€‚</p>
<ul>
<li>å°† EFLAG ç§»å…¥å’Œç§»å‡ºå †æ ˆæˆ– EAX å¯„å­˜å™¨ï¼šLAHFã€SAHFã€PUSHFã€PUSHFDã€PUSHFQã€POPFã€POPFD å’Œ POPFQã€‚</li>
<li>ä¿®æ”¹ EFLAG æ ‡è¯†ä½çš„æŒ‡ä»¤ï¼š<a href="https://directoree.github.io/post/WinXP-Struct/">BTã€BTSã€BTR å’Œ BTC</a>ã€‚</li>
<li><strong>IA-32e æ¨¡å¼ä¸‹ï¼Œä¸å…è®¸ä¿®æ”¹ VMã€NT ä½</strong>ï¼ˆIntel æ‰‹å†Œå·3 2.3.1ï¼‰ã€‚</li>
</ul>
<p><img data-src="https://s2.loli.net/2021/12/19/ySQIR7D1LpUgh3v.png" alt="58.png"></p>
<p><img data-src="https://s2.loli.net/2022/10/20/xipeXTMdJuj1trK.png" alt="3.png"></p>
<p>ä¸‹é¢ç½—åˆ—ä¸€äº›ä¸ç®—æœ¯ã€é€»è¾‘è¿ç®—ç›¸å…³çš„ä½ï¼š</p>
<table>
<thead>
<tr>
<th>æ ‡å¿—ä½</th>
<th>ä½ç½®</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>CFï¼ˆCarry flagï¼‰</td>
<td>Bit 0</td>
<td>è¿›ä½æ ‡å¿—ã€‚<strong>è´Ÿæ•°</strong>è®¡ç®—æº¢å‡ºæ—¶ç½®ä½ã€‚<br /><code>mov al, 0FFh  ; CF = 0</code><br /><code>add al, 1     ; CF = 1</code></td>
</tr>
<tr>
<td>OFï¼ˆOverflow flag ï¼‰</td>
<td>Bit 11</td>
<td>æº¢å‡ºæ ‡å¿—ã€‚æ“ä½œå‘ç”Ÿæº¢å‡ºï¼Œå¯¼è‡´ç¬¦å·æ”¹å˜ï¼ˆ<strong>ä»…å¯¹æœ‰ç¬¦å·æ•°</strong>ï¼‰ã€‚<br /><code>mov cl, 07Fh   ; OF = 0</code><br ><code>add cl, 1      ; OF = 1</code></td>
</tr>
<tr>
<td>ZFï¼ˆZero flagï¼‰</td>
<td>Bit 6</td>
<td>é›¶æ ‡å¿—ã€‚å½“ç®—æœ¯æˆ–é€»è¾‘è¿ç®—çš„ç»“æœä¸ºé›¶æ—¶è®¾ç½®è¯¥æ ‡å¿—ã€‚ è¿™ä¹Ÿå¯ä»¥ä½¿ç”¨æ¯”è¾ƒæŒ‡ä»¤è¿›è¡Œè®¾ç½®ã€‚</td>
</tr>
<tr>
<td>SFï¼ˆSign flagï¼‰</td>
<td>Bit 7</td>
<td>è´Ÿæ•°ç¬¦å·æ ‡å¿—ã€‚è¿ç®—ç»“æœæ˜¯<strong>è´Ÿæ•°</strong>æ—¶ç½® 1ã€‚</td>
</tr>
</tbody></table>
<h2 id="3-å‡½æ•°æ“ä½œ"><a href="#3-å‡½æ•°æ“ä½œ" class="headerlink" title="3 å‡½æ•°æ“ä½œ"></a>3 å‡½æ•°æ“ä½œ</h2><p>å‡½æ•°è°ƒç”¨çº¦å®šï¼š<code>__fastcall</code>ã€‚</p>
<ul>
<li>è°ƒç”¨è€…åœ¨å †æ ˆä¸­ä¼šç»™ RCXã€RDXã€R8ã€R9 é¢„ç•™ 0x20 å­—èŠ‚çš„ç©ºé—´ã€‚</li>
</ul>
<p>å †æ ˆå­—èŠ‚å¯¹é½ï¼š</p>
<ul>
<li>x86ï¼š8 å­—èŠ‚ã€‚</li>
<li>x64ï¼š16 å­—èŠ‚ã€‚</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/build/prolog-and-epilog?view=msvc-170">x64 prolog å’Œ epilog</a>ï¼š</p>
<p>åˆ†é…å †æ ˆç©ºé—´ã€è°ƒç”¨å…¶ä»–å‡½æ•°ã€ä¿å­˜éæ˜“å¤±æ€§å¯„å­˜å™¨æˆ–ä½¿ç”¨å¼‚å¸¸å¤„ç†çš„æ¯ä¸ªå‡½æ•°éƒ½å¿…é¡»å…·æœ‰ <code>prolog</code>ï¼Œå…¶åœ°å€é™åˆ¶åœ¨ä¸ç›¸åº”å‡½æ•°è¡¨æ¡ç›®å…³è”çš„å±•å¼€æ•°æ®ä¸­è¿›è¡Œäº†æè¿°ã€‚ ä¸ä¹‹å¯¹åº”çš„æ˜¯ epilogã€‚æœ‰äº†è¿™ä¸¤éƒ¨åˆ†ï¼Œx64 å‡½æ•°å’Œ x86 å‡½æ•°åœ¨å †æ ˆå¹³è¡¡çš„å¤„ç†ä¸Šæœ‰äº†è¾ƒå¤§çš„åŒºåˆ«ã€‚<strong>x64 çš„å‡½æ•°å†…åœ¨ä¸€å¼€å§‹ä½¿ç”¨ prolog æ¥å¼€è¾Ÿå †æ ˆï¼Œåœ¨æœ€åæ—¶æ‰ä½¿ç”¨ epilog æ¥å¹³è¡¡å †æ ˆã€‚è€Œä¸åƒæ˜¯ x86 ä¸­çš„ <code>__cdecl</code> è°ƒç”¨çº¦å®šé‚£æ ·æ¯æ¬¡è°ƒç”¨å®Œå‡½æ•°ç«‹å³è¦å¹³è¡¡å †æ ˆã€‚x64 æ˜¯åœ¨å‡½æ•°æœ€åçš„ epilog æ¥å¹³è¡¡å †æ ˆ</strong>ã€‚</p>
<p>å‡½æ•°ç»“æ„ä¸­å…¸å‹ prolog å’Œ epilog çš„ä»£ç å¯èƒ½æ˜¯ï¼ˆç±»ä¼¼äº x86 å¼‚å¸¸å¤„ç†ä¸­çš„å®‰è£… SEHï¼‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> prolog:</span><br><span class="line">    mov    [RSP + <span class="number">8</span>], RCX	</span><br><span class="line">    push   R15	<span class="comment">// ä¿å­˜éæ˜“å¤±æ€§å¯„å­˜å™¨</span></span><br><span class="line">    push   R14</span><br><span class="line">    push   R13</span><br><span class="line">    sub    RSP, fixed-allocation-size	<span class="comment">// åˆ†é…å †æ ˆ</span></span><br><span class="line">    lea    R13, <span class="number">128</span>[RSP]</span><br><span class="line">    </span><br><span class="line">    å‡½æ•°ä¸»ä½“...</span><br><span class="line"></span><br><span class="line">epilog:</span><br><span class="line">    add      RSP, fixed-allocation-size</span><br><span class="line">    pop      R13</span><br><span class="line">    pop      R14</span><br><span class="line">    pop      R15</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure>





<h3 id="3-1-è°ƒç”¨çº¦å®š"><a href="#3-1-è°ƒç”¨çº¦å®š" class="headerlink" title="3.1 è°ƒç”¨çº¦å®š"></a>3.1 è°ƒç”¨çº¦å®š</h3><p>x64 ä»…ä½¿ç”¨ <code>__fastcall</code> å‡½æ•°è°ƒç”¨çº¦å®šã€‚</p>
<p>x86 ä½¿ç”¨ <code>__cdecl</code>ã€<code>__stdcall</code>ã€<code>__fastcall</code>ã€<code>__thiscall</code>ã€‚</p>
<p>x64 ä¸­ä¸ç®¡åœ¨å‡½æ•°å‰é¢å£°æ˜å“ªä¸€ç§è°ƒç”¨çº¦å®šï¼Œç¼–è¯‘å™¨éƒ½åªä¼šåªç”¨ <code>__fastcall</code>ã€‚</p>
<p>Visual C&#x2F;C++ ç¼–è¯‘å™¨æ”¯æŒä¸‹åˆ—<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/cpp/argument-passing-and-naming-conventions?view=msvc-170">è°ƒç”¨çº¦å®š</a>ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å…³é”®å­—</th>
<th align="left">å †æ ˆæ¸…ç†</th>
<th align="left">å‚æ•°ä¼ é€’</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/cpp/cdecl?view=msvc-170">__cdecl</a></td>
<td align="left">è°ƒç”¨æ–¹</td>
<td align="left">åœ¨å †æ ˆä¸ŠæŒ‰ç›¸åé¡ºåºæ¨é€å‚æ•°ï¼ˆä»å³åˆ°å·¦ï¼‰</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/cpp/clrcall?view=msvc-170">__clrcall</a></td>
<td align="left">ä¸é€‚ç”¨</td>
<td align="left">æŒ‰é¡ºåºå°†å‚æ•°åŠ è½½åˆ° CLR è¡¨è¾¾å¼å †æ ˆä¸Šï¼ˆä»å·¦åˆ°å³ï¼‰</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/cpp/stdcall?view=msvc-170">__stdcall</a></td>
<td align="left">è¢«è°ƒç”¨æ–¹</td>
<td align="left">åœ¨å †æ ˆä¸ŠæŒ‰ç›¸åé¡ºåºæ¨é€å‚æ•°ï¼ˆä»å³åˆ°å·¦ï¼‰</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/cpp/fastcall?view=msvc-170">__fastcall</a></td>
<td align="left"><strong>è¢«è°ƒç”¨æ–¹</strong></td>
<td align="left"><strong>å‰ 4 ä¸ªå‚æ•°ä¾æ­¤é€šè¿‡ RCXã€RDXã€R8ã€R9å¯„å­˜å™¨ä¼ é€’ï¼Œå…¶ä½™å‚æ•°ä»å³åˆ°å·¦å‹å…¥å †æ ˆ</strong></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/cpp/thiscall?view=msvc-170">__thiscall</a></td>
<td align="left">è¢«è°ƒç”¨æ–¹</td>
<td align="left">åœ¨å †æ ˆä¸Šæ¨é€ï¼›å­˜å‚¨åœ¨ ECX ä¸­çš„ <strong><code>this</code></strong> æŒ‡é’ˆ</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/cpp/vectorcall?view=msvc-170">__vectorcall</a></td>
<td align="left">è¢«è°ƒç”¨æ–¹</td>
<td align="left">å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ï¼Œç„¶åæŒ‰ç›¸åé¡ºåºåœ¨å †æ ˆä¸Šæ¨é€ï¼ˆä»å³åˆ°å·¦ï¼‰</td>
</tr>
</tbody></table>
<p><img data-src="https://s2.loli.net/2022/10/20/HbloO1uRwiaNLrV.png" alt="7.png"></p>
<h3 id="3-2-å †æ ˆå¯¹é½"><a href="#3-2-å †æ ˆå¯¹é½" class="headerlink" title="3.2 å †æ ˆå¯¹é½"></a>3.2 å †æ ˆå¯¹é½</h3><p>å †ç®¡ç†å™¨ä¸­çš„åˆ†é…ç²’åº¦ç›¸å¯¹è¾ƒå°ï¼š<strong>åœ¨ 32 ä½ç³»ç»Ÿä¸Šæ˜¯ 8 å­—èŠ‚ï¼Œåœ¨ 64ä½ ç³»ç»Ÿä¸Šæ˜¯ 16 å­—èŠ‚</strong>ã€‚è¿™éƒ¨åˆ†åœ¨ã€Š<a href="https://directoree.github.io/post/x86-Memory2/">x86 å†…å­˜ç®¡ç†ï¼ˆäºŒï¼‰ç§æœ‰å†…å­˜-å…±äº«å†…å­˜-ç‰©ç†å†…å­˜</a>ã€‹å †ç®¡ç†å™¨ç« èŠ‚æåˆ°è¿‡ã€‚</p>
<p>åœ¨ x64 ä¸­ï¼Œä¸ºäº†ä¿è¯ CPU è®¿é—®å†…å­˜çš„é«˜æ•ˆæ€§ï¼Œ<strong>å †æ ˆå¿…é¡» 16 å­—èŠ‚å¯¹é½</strong>ã€‚ä¸‹ä¸€å°èŠ‚ <code>3ä¸ªå‚æ•°Release</code> ç”¨å®éªŒæ¥è¿›è¡Œè¯´æ˜ã€‚</p>
<h3 id="3-3-x64-æ•°æ®ç±»å‹å¤§å°"><a href="#3-3-x64-æ•°æ®ç±»å‹å¤§å°" class="headerlink" title="3.3 x64 æ•°æ®ç±»å‹å¤§å°"></a>3.3 x64 æ•°æ®ç±»å‹å¤§å°</h3><p>å‚è€ƒ<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/build/x64-software-conventions?view=msvc-170#x64-type-and-storage-layout">x64 ç±»å‹å’Œå­˜å‚¨å¸ƒå±€</a>ã€‚</p>
<table>
<thead>
<tr>
<th align="left">æ ‡é‡ç±»å‹</th>
<th align="left">C æ•°æ®ç±»å‹</th>
<th align="left">å­˜å‚¨å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</th>
<th align="left">å»ºè®®çš„å¯¹é½æ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><code>INT8</code></strong></td>
<td align="left"><strong><code>char</code></strong></td>
<td align="left">1</td>
<td align="left">Byte</td>
</tr>
<tr>
<td align="left"><strong><code>UINT8</code></strong></td>
<td align="left"><strong><code>unsigned char</code></strong></td>
<td align="left">1</td>
<td align="left">Byte</td>
</tr>
<tr>
<td align="left"><strong><code>INT16</code></strong></td>
<td align="left"><strong><code>short</code></strong></td>
<td align="left">2</td>
<td align="left">å­—</td>
</tr>
<tr>
<td align="left"><strong><code>UINT16</code></strong></td>
<td align="left"><strong><code>unsigned short</code></strong></td>
<td align="left">2</td>
<td align="left">å­—</td>
</tr>
<tr>
<td align="left"><strong><code>INT32</code></strong></td>
<td align="left"><strong><code>int</code></strong>, <strong><code>long</code></strong></td>
<td align="left">4</td>
<td align="left">åŒå­—</td>
</tr>
<tr>
<td align="left"><strong><code>UINT32</code></strong></td>
<td align="left"><strong><code>unsigned int</code></strong>, <strong><code>unsigned long</code></strong></td>
<td align="left">4</td>
<td align="left">åŒå­—</td>
</tr>
<tr>
<td align="left"><strong><code>INT64</code></strong></td>
<td align="left"><strong><code>__int64</code></strong></td>
<td align="left">8</td>
<td align="left">å››å­—</td>
</tr>
<tr>
<td align="left"><strong><code>UINT64</code></strong></td>
<td align="left"><strong><code>unsigned __int64</code></strong></td>
<td align="left">8</td>
<td align="left">å››å­—</td>
</tr>
<tr>
<td align="left"><strong><code>FP32</code></strong> ï¼ˆå•ç²¾åº¦ï¼‰</td>
<td align="left"><strong><code>float</code></strong></td>
<td align="left">4</td>
<td align="left">åŒå­—</td>
</tr>
<tr>
<td align="left"><strong><code>FP64</code></strong> ï¼ˆåŒç²¾åº¦ï¼‰</td>
<td align="left"><strong><code>double</code></strong></td>
<td align="left">8</td>
<td align="left">å››å­—</td>
</tr>
<tr>
<td align="left"><strong><code>POINTER</code></strong></td>
<td align="left">*</td>
<td align="left">8</td>
<td align="left">å››å­—</td>
</tr>
<tr>
<td align="left"><strong><code>__m64</code></strong></td>
<td align="left"><strong><code>struct __m64</code></strong></td>
<td align="left">8</td>
<td align="left">å››å­—</td>
</tr>
<tr>
<td align="left"><strong><code>__m128</code></strong></td>
<td align="left"><strong><code>struct __m128</code></strong></td>
<td align="left">16</td>
<td align="left">å…«å€é•¿å­—</td>
</tr>
</tbody></table>
<h3 id="3-4-å †æ ˆæ“ä½œ"><a href="#3-4-å †æ ˆæ“ä½œ" class="headerlink" title="3.4 å †æ ˆæ“ä½œ"></a>3.4 å †æ ˆæ“ä½œ</h3><h4 id="3ä¸ªå‚æ•°Debug"><a href="#3ä¸ªå‚æ•°Debug" class="headerlink" title="3ä¸ªå‚æ•°Debug"></a>3ä¸ªå‚æ•°Debug</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">__int64 <span class="title">Test3Parameters</span><span class="params">(__int64* arg_1, __int64 arg_2, __int64 arg_3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __int64 iLocal = <span class="number">0</span>;</span><br><span class="line">    iLocal = *arg_1;</span><br><span class="line">    <span class="keyword">return</span> iLocal + arg_2 + arg_3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __int64 arg = <span class="number">2</span>;</span><br><span class="line">    arg = Test3Parameters(&amp;arg, <span class="number">5</span>, <span class="number">9</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>main:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main</span></span><br><span class="line">.text:<span class="number">00000001400118E0</span> ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:<span class="number">00000001400118E0</span></span><br><span class="line">.text:<span class="number">00000001400118E0</span> ; Attributes: bp-based frame fpd=<span class="number">0F</span>0h</span><br><span class="line">.text:<span class="number">00000001400118E0</span></span><br><span class="line">.text:<span class="number">00000001400118E0</span> sub_1400118E0   proc near               ; CODE XREF: sub_1400112C1â†‘j</span><br><span class="line">.text:<span class="number">00000001400118E0</span></span><br><span class="line">.text:<span class="number">00000001400118E0</span> var_110         = byte ptr <span class="number">-110</span>h</span><br><span class="line">.text:<span class="number">00000001400118E0</span> var_F0          = byte ptr <span class="number">-0F</span>0h</span><br><span class="line">.text:<span class="number">00000001400118E0</span> var_E8          = qword ptr <span class="number">-0E8</span>h</span><br><span class="line">.text:<span class="number">00000001400118E0</span> var_18          = qword ptr <span class="number">-18</span>h</span><br><span class="line">.text:<span class="number">00000001400118E0</span></span><br><span class="line">.text:<span class="number">00000001400118E0</span> ; __unwind &#123; <span class="comment">// 14001119F</span></span><br><span class="line">.text:<span class="number">00000001400118E0</span>                 push    rbp</span><br><span class="line">.text:<span class="number">00000001400118E2</span>                 push    rdi</span><br><span class="line">.text:<span class="number">00000001400118E3</span>                 sub     rsp, <span class="number">108</span>h</span><br><span class="line">.text:<span class="number">00000001400118</span>EA                 lea     rbp, [rsp+<span class="number">20</span>h]</span><br><span class="line">.text:<span class="number">00000001400118</span>EF                 lea     rdi, [rsp+<span class="number">110</span>h+var_F0]	<span class="comment">//ç»™rcx,rdx,R8,R9é¢„ç•™çš„ç©ºé—´(0x20)</span></span><br><span class="line">.text:<span class="number">00000001400118F</span>4                 mov     ecx, <span class="number">0</span>Ah</span><br><span class="line">.text:<span class="number">00000001400118F</span>9                 mov     eax, <span class="number">0</span>CCCCCCCCh</span><br><span class="line">.text:<span class="number">00000001400118F</span>E                 rep stosd</span><br><span class="line">.text:<span class="number">0000000140011900</span>                 mov     rax, cs:__security_cookie</span><br><span class="line">.text:<span class="number">0000000140011907</span>                 <span class="keyword">xor</span>     rax, rbp</span><br><span class="line">.text:<span class="number">000000014001190</span>A                 mov     [rbp+<span class="number">0F</span>0h+var_18], rax	</span><br><span class="line">.text:<span class="number">0000000140011911</span>                 lea     rcx, unk_140023035<span class="comment">//è¯¥åœ°å€çš„åœ°å€é‡Œé¢å­˜æ”¾æ•°å­—1</span></span><br><span class="line">.text:<span class="number">0000000140011918</span>                 call    sub_1400113CF	<span class="comment">//CheckForDebuggerJustMyCode</span></span><br><span class="line">.text:<span class="number">000000014001191</span>D                 mov     [rbp+<span class="number">0F</span>0h+var_E8], <span class="number">2</span></span><br><span class="line">.text:<span class="number">0000000140011925</span>                 mov     r8d, <span class="number">9</span></span><br><span class="line">.text:<span class="number">000000014001192B</span>                 mov     edx, <span class="number">5</span></span><br><span class="line">.text:<span class="number">0000000140011930</span>                 lea     rcx, [rbp+<span class="number">0F</span>0h+var_E8]</span><br><span class="line">.text:<span class="number">0000000140011934</span>                 call    sub_140011136</span><br><span class="line">.text:<span class="number">0000000140011939</span>                 mov     [rbp+<span class="number">0F</span>0h+var_E8], rax</span><br><span class="line">.text:<span class="number">000000014001193</span>D                 mov     rdx, [rbp+<span class="number">0F</span>0h+var_E8]</span><br><span class="line">.text:<span class="number">0000000140011941</span>                 lea     rcx, aLld       ; <span class="string">&quot;%lld\n&quot;</span></span><br><span class="line">.text:<span class="number">0000000140011948</span>                 call    sub_14001143D</span><br><span class="line">.text:<span class="number">000000014001194</span>D                 <span class="keyword">xor</span>     eax, eax</span><br><span class="line">.text:<span class="number">000000014001194F</span>                 mov     edi, eax</span><br><span class="line">.text:<span class="number">0000000140011951</span>                 lea     rcx, [rbp+<span class="number">0F</span>0h+var_110]</span><br><span class="line">.text:<span class="number">0000000140011955</span>                 lea     rdx, unk_14001B850</span><br><span class="line">.text:<span class="number">000000014001195</span>C                 call    sub_14001135C</span><br><span class="line">.text:<span class="number">0000000140011961</span>                 mov     eax, edi</span><br><span class="line">.text:<span class="number">0000000140011963</span>                 mov     rcx, [rbp+<span class="number">0F</span>0h+var_18]</span><br><span class="line">.text:<span class="number">000000014001196</span>A                 <span class="keyword">xor</span>     rcx, rbp        ; StackCookie</span><br><span class="line">.text:<span class="number">000000014001196</span>D                 call    j___security_check_cookie</span><br><span class="line">.text:<span class="number">0000000140011972</span>                 lea     rsp, [rbp+<span class="number">0E8</span>h]</span><br><span class="line">.text:<span class="number">0000000140011979</span>                 pop     rdi</span><br><span class="line">.text:<span class="number">000000014001197</span>A                 pop     rbp</span><br><span class="line">.text:<span class="number">000000014001197B</span>                 retn</span><br><span class="line">.text:<span class="number">000000014001197B</span> ; &#125; <span class="comment">// starts at 1400118E0</span></span><br><span class="line">.text:<span class="number">000000014001197B</span> sub_1400118E0   endp</span><br></pre></td></tr></table></figure>

<p>å­å‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000140011870</span> ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:<span class="number">0000000140011870</span></span><br><span class="line">.text:<span class="number">0000000140011870</span> ; Attributes: bp-based frame fpd=<span class="number">0F</span>0h</span><br><span class="line">.text:<span class="number">0000000140011870</span></span><br><span class="line">.text:<span class="number">0000000140011870</span> sub_140011870   proc near               ; CODE XREF: .text:<span class="number">0000000140011087</span>â†‘j</span><br><span class="line">.text:<span class="number">0000000140011870</span>                                         ; sub_140011136â†‘j</span><br><span class="line">.text:<span class="number">0000000140011870</span></span><br><span class="line">.text:<span class="number">0000000140011870</span> var_E8          = qword ptr <span class="number">-0E8</span>h</span><br><span class="line">.text:<span class="number">0000000140011870</span> arg_0           = qword ptr  <span class="number">10</span>h</span><br><span class="line">.text:<span class="number">0000000140011870</span> arg_8           = qword ptr  <span class="number">18</span>h</span><br><span class="line">.text:<span class="number">0000000140011870</span> arg_10          = qword ptr  <span class="number">20</span>h</span><br><span class="line">.text:<span class="number">0000000140011870</span></span><br><span class="line">.text:<span class="number">0000000140011870</span>                 mov     [rsp<span class="number">-8</span>+arg_10], r8	<span class="comment">//rsp+0x18</span></span><br><span class="line">.text:<span class="number">0000000140011875</span>                 mov     [rsp<span class="number">-8</span>+arg_8], rdx</span><br><span class="line">.text:<span class="number">000000014001187</span>A                 mov     [rsp<span class="number">-8</span>+arg_0], rcx</span><br><span class="line">.text:<span class="number">000000014001187F</span>                 push    rbp</span><br><span class="line">.text:<span class="number">0000000140011880</span>                 push    rdi</span><br><span class="line">.text:<span class="number">0000000140011881</span>                 sub     rsp, <span class="number">108</span>h</span><br><span class="line">.text:<span class="number">0000000140011888</span>                 lea     rbp, [rsp+<span class="number">20</span>h]	<span class="comment">//ç»™rcx,rdx,R8,R9é¢„ç•™çš„ç©ºé—´(0x20)</span></span><br><span class="line">.text:<span class="number">000000014001188</span>D                 lea     rcx, unk_140023035<span class="comment">//è¯¥åœ°å€çš„åœ°å€é‡Œé¢å­˜æ”¾æ•°å­—1</span></span><br><span class="line">.text:<span class="number">0000000140011894</span>                 call    sub_1400113CF	<span class="comment">//CheckForDebuggerJustMyCode</span></span><br><span class="line">.text:<span class="number">0000000140011899</span>                 mov     [rbp+<span class="number">0F</span>0h+var_E8], <span class="number">0</span>	<span class="comment">//å±€éƒ¨å˜é‡</span></span><br><span class="line">.text:<span class="number">00000001400118</span>A1                 mov     rax, [rbp+<span class="number">0F</span>0h+arg_0]</span><br><span class="line">.text:<span class="number">00000001400118</span>A8                 mov     rax, [rax]</span><br><span class="line">.text:<span class="number">00000001400118</span>AB                 mov     [rbp+<span class="number">0F</span>0h+var_E8], rax</span><br><span class="line">.text:<span class="number">00000001400118</span>AF                 mov     rax, [rbp+<span class="number">0F</span>0h+arg_8]</span><br><span class="line">.text:<span class="number">00000001400118B</span>6                 mov     rcx, [rbp+<span class="number">0F</span>0h+var_E8]</span><br><span class="line">.text:<span class="number">00000001400118B</span>A                 add     rcx, rax</span><br><span class="line">.text:<span class="number">00000001400118B</span>D                 mov     rax, rcx</span><br><span class="line">.text:<span class="number">00000001400118</span>C0                 add     rax, [rbp+<span class="number">0F</span>0h+arg_10]</span><br><span class="line">.text:<span class="number">00000001400118</span>C7                 lea     rsp, [rbp+<span class="number">0E8</span>h]</span><br><span class="line">.text:<span class="number">00000001400118</span>CE                 pop     rdi</span><br><span class="line">.text:<span class="number">00000001400118</span>CF                 pop     rbp</span><br><span class="line">.text:<span class="number">00000001400118</span>D0                 retn</span><br><span class="line">.text:<span class="number">00000001400118</span>D0 sub_140011870   endp</span><br></pre></td></tr></table></figure>

<p><img data-src="https://s2.loli.net/2022/10/20/lxurpwdD5zV7I6t.png" alt="8.png"></p>
<h4 id="3-ä¸ªå‚æ•°Release"><a href="#3-ä¸ªå‚æ•°Release" class="headerlink" title="3 ä¸ªå‚æ•°Release"></a>3 ä¸ªå‚æ•°Release</h4><p>main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000140001070</span> ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:<span class="number">0000000140001070</span></span><br><span class="line">.text:<span class="number">0000000140001070</span></span><br><span class="line">.text:<span class="number">0000000140001070</span> sub_140001070   proc near               ; CODE XREF: sub_1400011A4+<span class="number">107</span>â†“p</span><br><span class="line">.text:<span class="number">0000000140001070</span>                                         ; DATA XREF: .pdata:<span class="number">000000014000400</span>Câ†“o</span><br><span class="line">.text:<span class="number">0000000140001070</span>                 sub     rsp, <span class="number">28</span>h</span><br><span class="line">.text:<span class="number">0000000140001074</span>                 mov     edx, <span class="number">10</span>h</span><br><span class="line">.text:<span class="number">0000000140001079</span>                 lea     rcx, aLld       ; <span class="string">&quot;%lld\n&quot;</span></span><br><span class="line">.text:<span class="number">0000000140001080</span>                 call    sub_140001010</span><br><span class="line">.text:<span class="number">0000000140001085</span>                 <span class="keyword">xor</span>     eax, eax</span><br><span class="line">.text:<span class="number">0000000140001087</span>                 add     rsp, <span class="number">28</span>h</span><br><span class="line">.text:<span class="number">000000014000108B</span>                 retn</span><br><span class="line">.text:<span class="number">000000014000108B</span> sub_140001070   endp</span><br></pre></td></tr></table></figure>

<p>Release ç‰ˆæœ¬ç›´æ¥å°†ç­”æ¡ˆè®¡ç®—å¥½äº†ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šè¿™é‡Œçš„ <code>sub    rsp, 28h</code> é™¤äº†ç»™ rcxï¼Œrdxï¼Œr8ï¼Œr9 é¢„ç•™ 0x20 å­—èŠ‚å¤§å°çš„ç©ºé—´å¤–ï¼Œè¿˜å¤šå‡ºæ¥äº† <code>0x8</code> å­—èŠ‚ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>ç­”æ¡ˆï¼šä¸ºäº†<strong>å’Œè¿”å›åœ°å€æ„æˆ <code>16(0x10)</code> å­—èŠ‚å¯¹é½</strong>ï¼</p>
<p>è§‚å¯Ÿæ­¤æ—¶çš„å †æ ˆæƒ…å†µï¼š</p>
<p><img data-src="https://s2.loli.net/2022/10/20/5NrYf29H6eqTlFG.png" alt="9.png"></p>
<h4 id="6ä¸ªå‚æ•°Debug"><a href="#6ä¸ªå‚æ•°Debug" class="headerlink" title="6ä¸ªå‚æ•°Debug"></a>6ä¸ªå‚æ•°Debug</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">__int64 <span class="title">Test3Parameters</span><span class="params">(__int64* arg_1, __int64 arg_2, __int64 arg_3, __int64 arg_4, __int64 arg_5, __int64 arg_6)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __int64 iLocal = <span class="number">0</span>;</span><br><span class="line">    iLocal = *arg_1;</span><br><span class="line">    <span class="keyword">return</span> iLocal + arg_2 + arg_3 - arg_4 + arg_5 + arg_6;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __int64 arg = <span class="number">2</span>;</span><br><span class="line">    arg = Test3Parameters(&amp;arg, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000140011</span>AC0 ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0 ; Attributes: bp-based frame fpd=<span class="number">0F</span>0h</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0 sub_140011AC0   proc near               ; CODE XREF: sub_1400112C1â†‘j</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0 var_120         = byte ptr <span class="number">-120</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0 var_100         = qword ptr <span class="number">-100</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0 var_F8          = qword ptr <span class="number">-0F</span>8h</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0 var_F0          = byte ptr <span class="number">-0F</span>0h</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0 var_E8          = qword ptr <span class="number">-0E8</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0 var_18          = qword ptr <span class="number">-18</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0</span><br><span class="line">.text:<span class="number">0000000140011</span>AC0 ; __unwind &#123; <span class="comment">// 14001119F</span></span><br><span class="line">.text:<span class="number">0000000140011</span>AC0                 push    rbp</span><br><span class="line">.text:<span class="number">0000000140011</span>AC2                 push    rdi</span><br><span class="line">.text:<span class="number">0000000140011</span>AC3                 sub     rsp, <span class="number">118</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>ACA                 lea     rbp, [rsp+<span class="number">30</span>h]</span><br><span class="line">.text:<span class="number">0000000140011</span>ACF                 lea     rdi, [rsp+<span class="number">120</span>h+var_F0]</span><br><span class="line">.text:<span class="number">0000000140011</span>AD4                 mov     ecx, <span class="number">0</span>Ah</span><br><span class="line">.text:<span class="number">0000000140011</span>AD9                 mov     eax, <span class="number">0</span>CCCCCCCCh</span><br><span class="line">.text:<span class="number">0000000140011</span>ADE                 rep stosd</span><br><span class="line">.text:<span class="number">0000000140011</span>AE0                 mov     rax, cs:__security_cookie</span><br><span class="line">.text:<span class="number">0000000140011</span>AE7                 <span class="keyword">xor</span>     rax, rbp</span><br><span class="line">.text:<span class="number">0000000140011</span>AEA                 mov     [rbp+<span class="number">0F</span>0h+var_18], rax</span><br><span class="line">.text:<span class="number">0000000140011</span>AF1                 lea     rcx, unk_140023035</span><br><span class="line">.text:<span class="number">0000000140011</span>AF8                 call    sub_1400113CF</span><br><span class="line">.text:<span class="number">0000000140011</span>AFD                 mov     [rbp+<span class="number">0F</span>0h+var_E8], <span class="number">2</span></span><br><span class="line">.text:<span class="number">0000000140011B</span>05                 mov     [rsp+<span class="number">120</span>h+var_F8], <span class="number">8</span></span><br><span class="line">.text:<span class="number">0000000140011B</span>0E                 mov     [rsp+<span class="number">120</span>h+var_100], <span class="number">6</span></span><br><span class="line">.text:<span class="number">0000000140011B</span>17                 mov     r9d, <span class="number">5</span></span><br><span class="line">.text:<span class="number">0000000140011B</span>1D                 mov     r8d, <span class="number">4</span></span><br><span class="line">.text:<span class="number">0000000140011B</span>23                 mov     edx, <span class="number">3</span></span><br><span class="line">.text:<span class="number">0000000140011B</span>28                 lea     rcx, [rbp+<span class="number">0F</span>0h+var_E8]</span><br><span class="line">.text:<span class="number">0000000140011B</span>2C                 call    sub_14001144C</span><br><span class="line">.text:<span class="number">0000000140011B</span>31                 mov     [rbp+<span class="number">0F</span>0h+var_E8], rax</span><br><span class="line">.text:<span class="number">0000000140011B</span>35                 mov     rdx, [rbp+<span class="number">0F</span>0h+var_E8]</span><br><span class="line">.text:<span class="number">0000000140011B</span>39                 lea     rcx, aLld       ; <span class="string">&quot;%lld\n&quot;</span></span><br><span class="line">.text:<span class="number">0000000140011B</span>40                 call    sub_14001143D</span><br><span class="line">.text:<span class="number">0000000140011B</span>45                 <span class="keyword">xor</span>     eax, eax</span><br><span class="line">.text:<span class="number">0000000140011B</span>47                 mov     edi, eax</span><br><span class="line">.text:<span class="number">0000000140011B</span>49                 lea     rcx, [rbp+<span class="number">0F</span>0h+var_120]</span><br><span class="line">.text:<span class="number">0000000140011B</span>4D                 lea     rdx, unk_14001B850</span><br><span class="line">.text:<span class="number">0000000140011B</span>54                 call    sub_14001135C</span><br><span class="line">.text:<span class="number">0000000140011B</span>59                 mov     eax, edi</span><br><span class="line">.text:<span class="number">0000000140011B</span>5B                 mov     rcx, [rbp+<span class="number">0F</span>0h+var_18]</span><br><span class="line">.text:<span class="number">0000000140011B</span>62                 <span class="keyword">xor</span>     rcx, rbp        ; StackCookie</span><br><span class="line">.text:<span class="number">0000000140011B</span>65                 call    j___security_check_cookie</span><br><span class="line">.text:<span class="number">0000000140011B</span>6A                 lea     rsp, [rbp+<span class="number">0E8</span>h]</span><br><span class="line">.text:<span class="number">0000000140011B</span>71                 pop     rdi</span><br><span class="line">.text:<span class="number">0000000140011B</span>72                 pop     rbp</span><br><span class="line">.text:<span class="number">0000000140011B</span>73                 retn</span><br><span class="line">.text:<span class="number">0000000140011B</span>73 ; &#125; <span class="comment">// starts at 140011AC0</span></span><br><span class="line">.text:<span class="number">0000000140011B</span>73 sub_140011AC0   endp</span><br></pre></td></tr></table></figure>

<p>å­å‡½æ•°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000140011</span>A40 sub_140011A40   proc near               ; CODE XREF: sub_14001144Câ†‘j</span><br><span class="line">.text:<span class="number">0000000140011</span>A40</span><br><span class="line">.text:<span class="number">0000000140011</span>A40 var_E8          = qword ptr <span class="number">-0E8</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>A40 arg_0           = qword ptr  <span class="number">10</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>A40 arg_8           = qword ptr  <span class="number">18</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>A40 arg_10          = qword ptr  <span class="number">20</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>A40 arg_18          = qword ptr  <span class="number">28</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>A40 arg_20          = qword ptr  <span class="number">30</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>A40 arg_28          = qword ptr  <span class="number">38</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>A40</span><br><span class="line">.text:<span class="number">0000000140011</span>A40                 mov     [rsp<span class="number">-8</span>+arg_18], r9</span><br><span class="line">.text:<span class="number">0000000140011</span>A45                 mov     [rsp<span class="number">-8</span>+arg_10], r8</span><br><span class="line">.text:<span class="number">0000000140011</span>A4A                 mov     [rsp<span class="number">-8</span>+arg_8], rdx</span><br><span class="line">.text:<span class="number">0000000140011</span>A4F                 mov     [rsp<span class="number">-8</span>+arg_0], rcx</span><br><span class="line">.text:<span class="number">0000000140011</span>A54                 push    rbp</span><br><span class="line">.text:<span class="number">0000000140011</span>A55                 push    rdi</span><br><span class="line">.text:<span class="number">0000000140011</span>A56                 sub     rsp, <span class="number">108</span>h</span><br><span class="line">.text:<span class="number">0000000140011</span>A5D                 lea     rbp, [rsp+<span class="number">20</span>h]</span><br><span class="line">.text:<span class="number">0000000140011</span>A62                 lea     rcx, unk_140023035</span><br><span class="line">.text:<span class="number">0000000140011</span>A69                 call    sub_1400113CF</span><br><span class="line">.text:<span class="number">0000000140011</span>A6E                 mov     [rbp+<span class="number">0F</span>0h+var_E8], <span class="number">0</span></span><br><span class="line">.text:<span class="number">0000000140011</span>A76                 mov     rax, [rbp+<span class="number">0F</span>0h+arg_0]</span><br><span class="line">.text:<span class="number">0000000140011</span>A7D                 mov     rax, [rax]</span><br><span class="line">.text:<span class="number">0000000140011</span>A80                 mov     [rbp+<span class="number">0F</span>0h+var_E8], rax</span><br><span class="line">.text:<span class="number">0000000140011</span>A84                 mov     rax, [rbp+<span class="number">0F</span>0h+arg_8]</span><br><span class="line">.text:<span class="number">0000000140011</span>A8B                 mov     rcx, [rbp+<span class="number">0F</span>0h+var_E8]</span><br><span class="line">.text:<span class="number">0000000140011</span>A8F                 add     rcx, rax</span><br><span class="line">.text:<span class="number">0000000140011</span>A92                 mov     rax, rcx</span><br><span class="line">.text:<span class="number">0000000140011</span>A95                 add     rax, [rbp+<span class="number">0F</span>0h+arg_10]</span><br><span class="line">.text:<span class="number">0000000140011</span>A9C                 sub     rax, [rbp+<span class="number">0F</span>0h+arg_18]</span><br><span class="line">.text:<span class="number">0000000140011</span>AA3                 add     rax, [rbp+<span class="number">0F</span>0h+arg_20]</span><br><span class="line">.text:<span class="number">0000000140011</span>AAA                 add     rax, [rbp+<span class="number">0F</span>0h+arg_28]</span><br><span class="line">.text:<span class="number">0000000140011</span>AB1                 lea     rsp, [rbp+<span class="number">0E8</span>h]</span><br><span class="line">.text:<span class="number">0000000140011</span>AB8                 pop     rdi</span><br><span class="line">.text:<span class="number">0000000140011</span>AB9                 pop     rbp</span><br><span class="line">.text:<span class="number">0000000140011</span>ABA                 retn</span><br><span class="line">.text:<span class="number">0000000140011</span>ABA sub_140011A40   endp</span><br></pre></td></tr></table></figure>



<h4 id="6ä¸ªå‚æ•°Release"><a href="#6ä¸ªå‚æ•°Release" class="headerlink" title="6ä¸ªå‚æ•°Release"></a>6ä¸ªå‚æ•°Release</h4><p>main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000140001070</span> sub_140001070   proc near               ; CODE XREF: sub_1400011A4+<span class="number">107</span>â†“p</span><br><span class="line">.text:<span class="number">0000000140001070</span>                                         ; DATA XREF: .pdata:<span class="number">000000014000400</span>Câ†“o</span><br><span class="line">.text:<span class="number">0000000140001070</span>                 sub     rsp, <span class="number">28</span>h</span><br><span class="line">.text:<span class="number">0000000140001074</span>                 mov     edx, <span class="number">12</span>h</span><br><span class="line">.text:<span class="number">0000000140001079</span>                 lea     rcx, aLld       ; <span class="string">&quot;%lld\n&quot;</span></span><br><span class="line">.text:<span class="number">0000000140001080</span>                 call    sub_140001010</span><br><span class="line">.text:<span class="number">0000000140001085</span>                 <span class="keyword">xor</span>     eax, eax</span><br><span class="line">.text:<span class="number">0000000140001087</span>                 add     rsp, <span class="number">28</span>h</span><br><span class="line">.text:<span class="number">000000014000108B</span>                 retn</span><br><span class="line">.text:<span class="number">000000014000108B</span> sub_140001070   endp</span><br></pre></td></tr></table></figure>



<h2 id="4-å…¶ä»–çŸ¥è¯†ç‚¹"><a href="#4-å…¶ä»–çŸ¥è¯†ç‚¹" class="headerlink" title="4 å…¶ä»–çŸ¥è¯†ç‚¹"></a>4 å…¶ä»–çŸ¥è¯†ç‚¹</h2><h3 id="4-0-x64å¯„å­˜å™¨ä½¿ç”¨æ³¨æ„"><a href="#4-0-x64å¯„å­˜å™¨ä½¿ç”¨æ³¨æ„" class="headerlink" title="4.0 x64å¯„å­˜å™¨ä½¿ç”¨æ³¨æ„"></a>4.0 x64å¯„å­˜å™¨ä½¿ç”¨æ³¨æ„</h3><ol>
<li><p>å¯„å­˜å™¨çš„ä½¿ç”¨ã€‚</p>
<div class="note success"><ol>
<li>å¯¹ 32 ä½å¯„å­˜å™¨çš„<strong>å†™æ“ä½œ</strong>ï¼ˆåŒ…æ‹¬è¿ç®—ç»“æœï¼‰ï¼Œä¼šè‡ªåŠ¨<strong>å¯¹ç›¸åº”çš„ 64 ä½å¯„å­˜å™¨çš„é«˜ 32 ä½æ¸… 0</strong>ã€‚</li>
<li>ä½†æ˜¯å¯¹ 16 ä½çš„å¯„å­˜å™¨è¿›è¡Œæ“ä½œï¼Œæ˜¯ä¸ä¼šå½±å“é«˜ä½çš„ï¼Œä¸ä¼šè‡ªåŠ¨æ¸…é›¶ã€‚</li>
</ol>
</div>

<p>å¦‚ä¸‹æŒ‡ä»¤ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ“ä½œ 32 ä½å¯„å­˜å™¨ï¼Œå¦‚ä¸‹ä¸¤ä¸ª xor æŒ‡ä»¤ç­‰ä»·</span></span><br><span class="line"><span class="keyword">xor</span> eax, eax;</span><br><span class="line"><span class="keyword">xor</span> rax, rax;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ“ä½œ 32 ä½å¯„å­˜å™¨ï¼Œå¦‚ä¸‹æŒ‡ä»¤æœ€å rbx å¯„å­˜å™¨çš„å€¼ä¸º 1 </span></span><br><span class="line"><span class="comment">// ç»“æœä¸º 0x0000000000000001</span></span><br><span class="line">mov rbx, <span class="number">0xFFEEDDCCAABB2230</span>;</span><br><span class="line">mov ebx, <span class="number">0x1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ“ä½œ 16 ä½å¯„å­˜å™¨ï¼Œå¦‚ä¸‹æŒ‡ä»¤æœ€å rbx å¯„å­˜å™¨çš„å€¼ä¸ä¸º 1 </span></span><br><span class="line"><span class="comment">// ç»“æœä¸º 0xFFEEDDCCAABB0001</span></span><br><span class="line">mov rbx, <span class="number">0xFFEEDDCCAABB2230</span>;</span><br><span class="line">mov bx, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>




</li>
<li><p>ç«‹å³æ•°çš„ä½¿ç”¨ã€‚</p>
<p>ç«‹å³æ•°çš„ä½¿ç”¨ï¼Œä¼˜å…ˆä½¿ç”¨ 32 ä½å¯„å­˜å™¨ï¼ˆå› ä¸º 64 ä½æŒ‡ä»¤è¾ƒé•¿ï¼‰ã€‚å¦‚æ“ä½œæ•°ä½å®½ä¸è¶…è¿‡ 32 ä½ï¼Œç¡¬å°½é‡ä½¿ç”¨ 32 ä½çš„å¯„å­˜å™¨ã€‚</p>
<blockquote>
<p>å‚æ•°é•¿åº¦ä¸è¶…è¿‡4ä¸ªå­—èŠ‚çš„æ—¶å€™ï¼Œåˆ†åˆ«ä½¿ç”¨32ä½çš„å¯„å­˜å™¨è¿›è¡Œä¼ å‚ï¼Œè¿™ä¸ªæ˜¯ç¼–è¯‘å™¨åšçš„å¤„ç†ï¼Œé•¿åº¦è¶³å¤Ÿå­˜å‚¨æ•°æ®çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆä½¿ç”¨32ä½å¯„å­˜å™¨ï¼Œå› ä¸ºæ“ä½œ64ä½å¯„å­˜å™¨(å¦‚MOVæŒ‡ä»¤)çš„æŒ‡ä»¤å 4ä¸ªå­—èŠ‚ï¼Œå¤šä¸€ä¸ª48å‰ç¼€æŒ‡ä»¤ï¼Œè¯´æ˜æ“ä½œæ•°æ˜¯64ä½çš„ï¼Œè€Œ32ä½å¯„å­˜å™¨åªéœ€è¦3ä¸ªå­—èŠ‚çš„æŒ‡ä»¤é•¿åº¦ã€Š<a target="_blank" rel="noopener" href="https://jhinxs.com/x64%E7%9A%84%E4%B8%80%E4%BA%9B%E7%89%B9%E6%80%A7/">x64çš„ä¸€äº›ç‰¹æ€§</a>ã€‹</p>
</blockquote>
</li>
<li><p>x64 æŒ‡ä»¤é™åˆ¶ã€‚</p>
<ul>
<li><p><code>push/pop</code> çš„æ“ä½œæ•°åªèƒ½æ˜¯ 32 ä½ï¼Œæ— æ³•æ“ä½œ 64 ä½æ“ä½œæ•°ã€‚<code>pushad/popad</code> åœ¨ x64 ä¸­å°±å®Œå…¨ä¸æ”¯æŒã€‚ä½†æ˜¯å¯ä»¥ä½¿ç”¨ <code>pushfq/popfq</code>ã€‚</p>
</li>
<li><p>å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">push <span class="number">0x123456789</span>;	<span class="comment">// è¯¥æŒ‡ä»¤ä¸æ”¯æŒ</span></span><br><span class="line"><span class="comment">// å¯ä»¥æ›¿æ¢ä¸º</span></span><br><span class="line">mov rax, <span class="number">0x123456789</span>;</span><br><span class="line">push rax;</span><br><span class="line"></span><br><span class="line">mov qword ptr ds:[rax], <span class="number">0x123456789</span>;	<span class="comment">//	ä¸æ”¯æŒ</span></span><br><span class="line">mov qword ptr ds:[rax], <span class="number">0x12345678</span>;	<span class="comment">//	æ”¯æŒ</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>è®¿é—® <mark class="label success">RIP-2GB~RIP+2GB</mark> èŒƒå›´çš„åœ°å€éƒ½ä¼šä½¿ç”¨ <code>RIP-Relative</code>ï¼ˆè¿™é‡Œçš„ RIP ä¸ºå½“å‰æŒ‡ä»¤çš„åœ°å€ï¼‰æ¥è¿›è¡Œå¯»å€ã€‚</p>
<p>å¦‚<code>48:8B05</code> å‰ç¼€ä½¿ç”¨ RIP-Relativeï¼ˆè¿™é‡Œçš„ RIP ä¸ºå½“å‰æŒ‡ä»¤çš„åœ°å€ï¼‰ï¼šx64 ä¸­ï¼Œå¦‚æœè¦è®¿é—®çš„å†…å­˜åœ°å€èŒƒå›´åœ¨ <strong><code>RIP-2GB~RIP+2GB</code></strong> ï¼Œåˆ™ç¡¬ç¼–ç ä¼šä½¿ç”¨ç›¸å¯¹å¯»å€çš„æ–¹å¼ç¼–ç ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‰ç¼€åé¢æ˜¯ 00000000 åˆ™è®¿é—®çš„åœ°å€ä¸ºï¼šå½“å‰æŒ‡ä»¤åœ°å€+å½“å‰æŒ‡ä»¤é•¿åº¦(7) +00000000</span></span><br><span class="line"><span class="comment">// å‰ç¼€åé¢æ˜¯ 01000000 åˆ™è®¿é—®çš„åœ°å€ä¸ºï¼šå½“å‰æŒ‡ä»¤åœ°å€+å½“å‰æŒ‡ä»¤é•¿åº¦(7) +00000001</span></span><br><span class="line"><span class="number">00007F</span>F92E0D0F20 | <span class="number">48</span>:<span class="number">8B</span>05 <span class="number">00000000</span>         | mov rax,qword ptr ds:[<span class="number">7F</span>F92E0D0F27]  </span><br><span class="line"><span class="number">00007F</span>F92E0D0F27 | <span class="number">0048</span> <span class="number">85</span>                  | add byte ptr ds:[rax<span class="number">-7B</span>],cl       </span><br><span class="line"><span class="number">00007F</span>F92E0D0F2A | <span class="number">48</span>:<span class="number">8B</span>05 <span class="number">01000000</span>         | mov rax,qword ptr ds:[<span class="number">7F</span>F92E0D0F32] </span><br><span class="line"><span class="number">00007F</span>F92E0D0F31 | <span class="number">81</span>C1 F0040000            | add ecx,<span class="number">4F</span>0                                          </span><br></pre></td></tr></table></figure>


</li>
<li><p><code>jmp</code> ç¡¬ç¼–ç ã€‚</p>
<p>å¯çœ‹ Intel æ‰‹å†Œå·1</p>
<p>EBï¼šjmp rel8ï¼ŒJump shortï¼Œ<code>RIP = RIP+å½“å‰æŒ‡ä»¤é•¿åº¦ +(FF~7F)</code>ã€‚</p>
<p>E9ï¼šjmp rel16ï¼Œåœ¨ x64 ä¸‹ä¸æ”¯æŒã€‚</p>
<p>E9ï¼šjmp rel32ï¼ŒJump nearï¼Œ<code>RIP = RIP+å½“å‰æŒ‡ä»¤é•¿åº¦ +(-2G~2G)</code>ã€‚</p>
</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-222788.htm">64ä½ä¸‹çš„inline Hook</a>ã€<a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-270901.htm">R3 ä¸‹å¸¸ç”¨HookæŠ€æœ¯</a>ã€‚</p>
</li>
<li><p>åœ¨ x86 CPU ä¸Šï¼ŒFS æ®µå¯„å­˜å™¨æŒ‡å‘çº¿ç¨‹ç¯å¢ƒå— (TEB) å’Œå¤„ç†å™¨æ§åˆ¶åŒºåŸŸ (KPCR)ï¼Œä½†åœ¨ x64 ä¸Šï¼ŒGS å¯„å­˜å™¨åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æŒ‡å‘ TEBï¼Œåœ¨å†…æ ¸ä¸­æŒ‡å‘ KPCR çš„æ–°æ¨¡å¼ã€‚ç„¶è€Œï¼Œå½“è¿è¡Œ WOW64 åº”ç”¨ç¨‹åºï¼ˆå³ x64 ç³»ç»Ÿä¸Šçš„ 32 ä½åº”ç”¨ç¨‹åºï¼‰æ—¶ï¼ŒFS å¯„å­˜å™¨ç»§ç»­æŒ‡å‘ 32 ä½ç‰ˆæœ¬çš„ TEBã€‚<code>x64</code>ä¸Šçš„é™·é˜±å¸§ç»“æ„ä½“<code>nt!_KTRAP_FRAME</code>ä¸åŒ…å«éæ˜“å¤±æ€§å¯„å­˜å™¨çš„æœ‰æ•ˆå†…å®¹ã€‚å¦‚æœæ‰“ç®—ä¿®æ”¹éæ˜“å¤±æ€§å¯„å­˜å™¨ï¼Œ<code>X64</code>å‡½æ•°çš„<code>prolog</code>ä¼šä¿å­˜éæ˜“å¤±æ€§å¯„å­˜å™¨çš„å€¼ã€‚è°ƒè¯•å™¨å§‹ç»ˆå¯ä»¥ä»å †æ ˆä¸­æå–è¿™äº›éæ˜“å¤±æ€§å¯„å­˜å™¨çš„ä¿å­˜å€¼ï¼Œè€Œä¸å¿…ä»é™·é˜±å¸§ä¸­è·å–å®ƒä»¬ã€‚ åœ¨<code>x64</code>ä¸Šçš„å†…æ ¸æ¨¡å¼è°ƒè¯•æœŸé—´ï¼Œ<code>.trap</code>å‘½ä»¤çš„è¾“å‡ºä¼šæ‰“å°ä¸€æ¡æ³¨é‡Šï¼Œçªå‡ºæ˜¾ç¤ºä»é™·é˜±ä¸­æ£€ç´¢åˆ°çš„æ‰€æœ‰å¯„å­˜å™¨çš„å€¼å¯èƒ½ä¸å‡†ç¡®çš„äº‹å®ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æ­¤è§„åˆ™æœ‰ä¾‹å¤–ï¼Œä¾‹å¦‚ï¼Œä¸ºç”¨æˆ·åˆ°å†…æ ¸æ¨¡å¼è½¬æ¢ç”Ÿæˆçš„é™·é˜±å¸§ç¡®å®åŒ…å«æ‰€æœ‰å¯„å­˜å™¨çš„æ­£ç¡®å€¼ã€‚</p>
</li>
<li><p>å†…å­˜ä¼˜å…ˆä½¿ç”¨ç›¸å¯¹åç§»å¯»å€ï¼Œç›´æ¥å¯»å€æŒ‡ä»¤è¾ƒå°‘ã€‚</p>
</li>
</ol>
<h3 id="4-1-ASCII"><a href="#4-1-ASCII" class="headerlink" title="4.1 ASCII"></a>4.1 ASCII</h3><p>ASCII è¡¨çš„ <a target="_blank" rel="noopener" href="https://github.com/corkami/pics">Github é¡¹ç›®</a>ï¼š</p>
<p><img data-src="https://s2.loli.net/2022/10/21/zkRAXMj547wSmY3.png" alt="14.png"></p>
<h3 id="4-2-å°ç«¯å­˜å‚¨"><a href="#4-2-å°ç«¯å­˜å‚¨" class="headerlink" title="4.2 å°ç«¯å­˜å‚¨"></a>4.2 å°ç«¯å­˜å‚¨</h3><p><img data-src="https://s2.loli.net/2022/10/21/JcjZklFoROsMVhm.png" alt="13.png"></p>
<h3 id="4-3-æ±‡ç¼–ç¼–è¯‘å™¨"><a href="#4-3-æ±‡ç¼–ç¼–è¯‘å™¨" class="headerlink" title="4.3 æ±‡ç¼–ç¼–è¯‘å™¨"></a>4.3 æ±‡ç¼–ç¼–è¯‘å™¨</h3><ol>
<li>nasm, fasm, yasï¼šå…è´¹å¼€æºæ±‡ç¼–ç¼–è¯‘å™¨ï¼Œéƒ½æ˜¯ä½¿ç”¨ Intel è¯­æ³•ã€‚</li>
<li>yasm åœ¨ nasm åŸºç¡€ä¸Šå¼€å‘ï¼Œä½¿ç”¨ Intel è¯­æ³•ã€‚ </li>
<li>masmï¼šå¾®è½¯å‘å¸ƒçš„æ±‡ç¼–ç¼–è¯‘å™¨ï¼Œå·²é›†åˆåœ¨ VS ä¸­ï¼Œä½¿ç”¨ Intel è¯­æ³•ã€‚</li>
<li>gasï¼šlinux å…è´¹å¼€æºæ±‡ç¼–ç¼–è¯‘å™¨ï¼Œä½¿ç”¨ AT&amp;T è¯­æ³•ã€‚</li>
</ol>
<h3 id="4-4-æ•´æ•°å–å€¼èŒƒå›´"><a href="#4-4-æ•´æ•°å–å€¼èŒƒå›´" class="headerlink" title="4.4 æ•´æ•°å–å€¼èŒƒå›´"></a>4.4 æ•´æ•°å–å€¼èŒƒå›´</h3><p>åœ¨è®¡ç®—æœºå¤„ç†ä¸­ï¼Œæ•´æ•°ä¼šåŒºåˆ† signedï¼ˆæœ‰ç¬¦å·æ•°ï¼‰å’Œ unsignedï¼ˆæ— ç¬¦å·æ•°ï¼‰ä¸¤ç§æƒ… å†µï¼Œæ•°å€¼çš„ MSB å€¼è¢«ä½œä¸ºç¬¦å·ä½ã€‚æ¯ä¸ªæ•°å€¼ç±»å‹æœ‰è‡ªå·±çš„å–å€¼èŒƒå›´ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img data-src="https://s2.loli.net/2022/10/21/gjaq7AeTv6COWsF.png" alt="15.png"></p>
<h3 id="4-5-x64åœ°å€èŒƒå›´"><a href="#4-5-x64åœ°å€èŒƒå›´" class="headerlink" title="4.5 x64åœ°å€èŒƒå›´"></a>4.5 x64åœ°å€èŒƒå›´</h3><p>x64 ä½“ç³»é‡Œåªå®ç°äº†48 ä½çš„è™šæ‹Ÿåœ°å€ï¼Œé«˜16 ä½è¢«ç”¨åš<strong>ç¬¦å·</strong>æ‰©å±•ã€‚è¿™é«˜ 16 ä½å¿…é¡»å…¨æ˜¯ 0 æˆ–è€…å…¨æ˜¯ 1ï¼Œè¿™ç§å½¢å¼çš„åœ°å€è¢«ç§°ä¸º <code>canonical</code> åœ°å€ã€‚</p>
<p>å¤„ç†å™¨ä¼šå¯¹è½¯ä»¶ä¸Šçš„ <code>non-canonical </code> åœ°å€å½¢å¼è¿›è¡Œæ£€æŸ¥ï¼Œç¨‹åºä¸­è®¿é—®äº†<code>non-canonical </code> åœ°å€ä¼šäº§ç”Ÿ <code>#GP</code> å¼‚å¸¸ã€‚ </p>
<p><img data-src="https://s2.loli.net/2022/10/21/lSwWe6EZsJdIzqT.png" alt="16.png"></p>
<h3 id="4-6-çº¿æ€§åœ°å€"><a href="#4-6-çº¿æ€§åœ°å€" class="headerlink" title="4.6 çº¿æ€§åœ°å€"></a>4.6 çº¿æ€§åœ°å€</h3><p>åœ¨ x86 ä¿æŠ¤æ¨¡å¼ä¸‹ï¼š</p>
<p>é€»è¾‘åœ°å€ï¼š0x23:00400000ã€‚<code>0x23</code> ä¸ºæ®µé€‰æ‹©å­ï¼Œ<code>0x00400000</code> ä¸ºæ®µåç§»ã€‚</p>
<p>çº¿æ€§åœ°å€ï¼šåœ¨åˆ†é¡µæ¨¡å¼ä¸‹ä½¿ç”¨ï¼ŒMMU å°†é€»è¾‘åœ°å€å¯è½¬æ¢ä¸ºçº¿æ€§åœ°å€ã€‚ç”±äºé™¤äº† <code>FS</code> å…¶ä½™æ®µåŸºå€ä¸º <code>0</code>ï¼Œæ‰€ä»¥é€»è¾‘åœ°å€ç­‰äºçº¿æ€§åœ°å€ã€‚</p>
<p>è™šæ‹Ÿåœ°å€ï¼šé€»è¾‘åœ°å€å’Œçº¿æ€§åœ°å€éƒ½æ˜¯è™šæ‹Ÿåœ°å€ã€‚</p>
<p>åœ¨ x64 ä¸‹ï¼Œåªæœ‰çº¿æ€§åœ°å€ï¼ˆè™šæ‹Ÿåœ°å€ï¼‰ã€‚</p>
<ul>
<li>å®æ¨¡å¼ã€ä¿æŠ¤æ¨¡å¼ä¸‹çš„é€»è¾‘åœ°å€ï¼š$segment:offset$ã€‚<ul>
<li>å®æ¨¡å¼ï¼š$linear\_address &#x3D; segment &lt;&lt; 4 + offset$</li>
<li>ä¿æŠ¤æ¨¡å¼ï¼š$linear\_address &#x3D; segment\_base + offset$</li>
</ul>
</li>
<li>x64ï¼š$linear\_address &#x3D; offset$</li>
</ul>
<p>åœ¨ x64 ä¸‹ï¼Œé™¤äº† FS ä¸GS æ®µå¯ä»¥ä½¿ç”¨é 0 å€¼çš„ base å¤–ï¼Œå…¶ä½™çš„ ESã€ CSã€ DS åŠ SS æ®µçš„ base å€¼å¼ºåˆ¶ä¸º <code>0</code> å€¼ã€‚å› æ­¤ï¼Œå®é™…ä¸Šçº¿æ€§åœ°å€å°±ç­‰äºä»£ç ä¸­çš„ offset å€¼ã€‚</p>
<h3 id="4-7-RIP-Relative"><a href="#4-7-RIP-Relative" class="headerlink" title="4.7 RIP-Relative"></a>4.7 RIP-Relative</h3><h3 id="4-8-å†…å­˜å¯¹é½"><a href="#4-8-å†…å­˜å¯¹é½" class="headerlink" title="4.8 å†…å­˜å¯¹é½"></a>4.8 å†…å­˜å¯¹é½</h3><ul>
<li>x86ï¼š8 å­—èŠ‚å¯¹é½ï¼Œ<code>ESP &amp; 0xFFFFFFF8</code>ã€‚</li>
<li>x64ï¼š16 å­—èŠ‚å¯¹é½ï¼Œ<code>RSP &amp; 0xFFFFFFFF&#39;FFFFFFF0</code>ã€‚</li>
</ul>
<h2 id="5-64-ä½æ¨¡å¼çš„æŒ‡ä»¤"><a href="#5-64-ä½æ¨¡å¼çš„æŒ‡ä»¤" class="headerlink" title="5 64 ä½æ¨¡å¼çš„æŒ‡ä»¤"></a>5 64 ä½æ¨¡å¼çš„æŒ‡ä»¤</h2><h3 id="5-0-REX-prefix"><a href="#5-0-REX-prefix" class="headerlink" title="5.0 REX prefix"></a>5.0 REX prefix</h3><p>REX prefix æ˜¯ä¸å®šå€¼ï¼Œå®ƒçš„å–å€¼èŒƒå›´æ˜¯ï¼š<code>0x40 - 0x4F</code> ï¼ˆå…± 16 ä¸ªï¼‰ï¼Œé«˜ 4 ä½å›ºå®šä¸º 4ï¼Œä½ 4 ä½ä¸ºå˜åŒ–å€¼ã€‚</p>
<table>
<thead>
<tr>
<th>7</th>
<th>6</th>
<th>5</th>
<th>4</th>
<th>3</th>
<th>2</th>
<th>1</th>
<th>0</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>W</td>
<td>R</td>
<td>X</td>
<td>B</td>
</tr>
</tbody></table>
<p>ä½ 4 ä½è¡¨è¿°ä¸ºï¼š</p>
<ul>
<li>REX.W</li>
<li>REX.R</li>
<li>REX.X</li>
<li>REX.B</li>
</ul>
<p>å½“é»˜è®¤æ“ä½œæ•°å¤§å°ä¸º 32 ä½æ˜¯ï¼Œ <code>REX.W = 1</code>ï¼Œå³å‰ç¼€å–å€¼ä¸º <code>0x48</code> æ—¶ï¼Œåˆ™ä¼šå°†æ“ä½œæ•°å¤§å°æ”¹ä¸º 64 ä½ã€‚</p>
<h3 id="5-1-æ“ä½œæ•°å¤§å°ï¼ˆoperand-Sizeï¼‰"><a href="#5-1-æ“ä½œæ•°å¤§å°ï¼ˆoperand-Sizeï¼‰" class="headerlink" title="5.1 æ“ä½œæ•°å¤§å°ï¼ˆoperand Sizeï¼‰"></a>5.1 æ“ä½œæ•°å¤§å°ï¼ˆoperand Sizeï¼‰</h3><p>åœ¨ 64 ä½æ¨¡å¼ä¸‹ï¼Œä»…æœ‰å°‘æ•°æŒ‡ä»¤çš„é»˜è®¤æ“ä½œæ•°æ˜¯ 64 ä½ï¼Œå¤§å¤šæ•°æŒ‡ä»¤çš„é»˜è®¤æ“ä½œæ•°ä»æ˜¯ 32 ä½çš„ã€‚åœ¨é»˜è®¤æ“ä½œæ•°ä¸º 32 ä½çš„æŒ‡ä»¤ä¸­ï¼Œå¦‚æœè¦å°†å…¶å˜æˆ 64 ä½çš„æ“ä½œæ•°å¿…é¡»ä½¿ç”¨ <code>REX prefix</code>ã€‚</p>
<p>åœ¨ 64 ä½æ¨¡å¼ä¸‹æŒ‡ä»¤å¯ä»¥ä½¿ç”¨ 16 ä½çš„æ“ä½œæ•°ï¼Œä½†æ˜¯ï¼š<strong>å¦‚æœæŒ‡ä»¤é»˜è®¤æ“ä½œæ•°å¤§å°æ˜¯ 64 ä½æ—¶ï¼Œä¸èƒ½é€šè¿‡æŒ‡ä»¤å‰ç¼€æ¥å°†æ“ä½œæ•°å˜æˆ 32 ä½ï¼Œä½†æ˜¯å¯ä»¥å˜æˆ 16 ä½</strong>ã€‚<br><img data-src="https://s2.loli.net/2022/11/07/YpqxNQCVhw1d3i6.png" alt="52.png"></p>
<p><strong>ç¤ºä¾‹ä¸€ï¼šé»˜è®¤æ“ä½œæ•°å¤§å° 64  ä½</strong></p>
<p>åœ¨ x64 dbg è°ƒè¯•å™¨ä¸‹ï¼Œ<code>push </code> æŒ‡ä»¤é»˜è®¤æ“ä½œæ•°å¤§å°ä¸º 64 ä½ï¼Œå¦‚æœè¦ä½¿ç”¨ 16 ä½æ“ä½œæ•°éœ€åŠ å‰ç¼€ <code>0x66</code>ã€‚ä¸æ”¯æŒ 32 ä½æ“ä½œæ•°ã€‚</p>
<p><img data-src="https://s2.loli.net/2022/11/07/Hi53YJKFm6tWrg4.png" alt="53.png"></p>
<p><strong>ç¤ºä¾‹äºŒï¼šé»˜è®¤æ“ä½œæ•°å¤§å° 32 ä½</strong></p>
<p>åœ¨ x64 dbg è°ƒè¯•å™¨ä¸‹ï¼Œ<code>mov </code> æŒ‡ä»¤é»˜è®¤æ“ä½œæ•°å¤§å°ä¸º 32 ä½ï¼Œå¦‚æœè¦ä½¿ç”¨ 16 ä½æ“ä½œæ•°éœ€åŠ å‰ç¼€ <code>0x66</code>ã€‚ä½¿ç”¨ 64 ä½æ“ä½œæ•°éœ€åŠ å‰ç¼€ <code>0x48</code>ã€‚</p>
<p><img data-src="https://s2.loli.net/2022/11/07/hflDd8GQoc9FjeT.png" alt="54.png"></p>
<p><strong>é»˜è®¤æ“ä½œæ•°ä¸º64 ä½çš„æŒ‡ä»¤</strong><br>å°‘æ•°æŒ‡ä»¤çš„é»˜è®¤æ“ä½œæ•°æ˜¯ 64 ä½çš„ï¼Œè¿™äº›æŒ‡ä»¤åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ol>
<li>ä¾èµ–äº RIP æŒ‡é’ˆçš„ near branchï¼ˆè¿‘ç¨‹åˆ†æ”¯ï¼‰æŒ‡ä»¤ã€‚</li>
<li>ä¾èµ–äº RSP æŒ‡é’ˆçš„ stack æ“ä½œæŒ‡ä»¤ã€‚</li>
</ol>
<p><img data-src="https://s2.loli.net/2022/11/07/5lZ3NiX7aMYocnR.png" alt="55.png"></p>
<h3 id="5-2-64-ä½æ¨¡å¼æ— æ•ˆæŒ‡ä»¤"><a href="#5-2-64-ä½æ¨¡å¼æ— æ•ˆæŒ‡ä»¤" class="headerlink" title="5.2 64 ä½æ¨¡å¼æ— æ•ˆæŒ‡ä»¤"></a>5.2 64 ä½æ¨¡å¼æ— æ•ˆæŒ‡ä»¤</h3><p><img data-src="https://s2.loli.net/2022/11/07/TB8coQxKuEnqVSg.png" alt="56.png"></p>
<h3 id="5-3-å¯»å€åœ°å€å¤§å°ï¼ˆoperand-address-sizeï¼‰"><a href="#5-3-å¯»å€åœ°å€å¤§å°ï¼ˆoperand-address-sizeï¼‰" class="headerlink" title="5.3 å¯»å€åœ°å€å¤§å°ï¼ˆoperand address sizeï¼‰"></a>5.3 å¯»å€åœ°å€å¤§å°ï¼ˆoperand address sizeï¼‰</h3><ul>
<li>åœ¨ 64 ä½æ¨¡å¼ä¸‹ï¼ŒæŒ‡ä»¤çš„ default operand address sizeï¼ˆé»˜è®¤åœ°å€å¤§å°ï¼‰æ˜¯ 64 ä½çš„ï¼ŒæŒ‡çš„æ˜¯æ“ä½œæ•°çš„å¯»å€å¤§å°ã€‚</li>
<li>åœ¨ 64 ä½æ¨¡å¼ä¸‹ï¼ŒæŒ‡ä»¤çš„ default operand sizeï¼ˆé»˜è®¤æ“ä½œæ•°å¤§å°ï¼‰ä¸º 64 ä½æˆ– 32 ä½ã€‚</li>
</ul>
<p>æŒ‡ä»¤çš„é»˜è®¤åœ°å€å¤§å°åŒæ ·ç”± CS.L å’Œ CS.D æ ‡å¿—å†³å®šã€‚<br>â‘  CS.L &#x3D; 1 å¹¶ä¸” CS.D &#x3D; 0ï¼Œé»˜è®¤çš„åœ°å€æ˜¯ 64 ä½ã€‚<br>â‘¡ CS.L &#x3D; 0 å¹¶ä¸” CS.D &#x3D; 1ï¼Œåœ¨ compatibility æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ 32 ä½çš„é»˜è®¤åœ°å€ã€‚<br>â‘¢ CS.L &#x3D; 0 å¹¶ä¸” CS.D &#x3D; 0ï¼Œåœ¨ compatibility æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ 16 ä½çš„é»˜è®¤åœ°å€ã€‚</p>
<p><img data-src="https://s2.loli.net/2022/11/07/tKy1UdVubqxGJcZ.png" alt="57.png"> </p>
<p>å¦‚ä¸‹ï¼Œåœ¨ 64-bit æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ 32 ä½ å¯»å€æ—¶ä¼šä½¿ç”¨ <code>0x67</code> æŒ‡ä»¤å‰ç¼€ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00007F</span>FA2C7E0960  | <span class="number">6748</span>:<span class="number">8B</span>01                | mov rax,qword ptr ds:[ecx]    </span><br><span class="line"><span class="number">00007F</span>FA2C7E0964  | <span class="number">67</span>:FF30                  | push qword ptr ds:[eax]                 </span><br></pre></td></tr></table></figure>














    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    èµèµ
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechat.jpg" alt="Catecat å¾®ä¿¡">
        <span>å¾®ä¿¡</span>
      </div>
      <div>
        <img src="/images/alipay.jpg" alt="Catecat æ”¯ä»˜å®">
        <span>æ”¯ä»˜å®</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>Catecat
  </li>
  <li class="post-copyright-link">
      <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://directoree.github.io/post/x64-Disassembly2/" title="x64 æ±‡ç¼–åŸºç¡€">https://directoree.github.io/post/x64-Disassembly2/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Windows%E5%86%85%E6%A0%B8/" rel="tag"><i class="fa fa-tag"></i> Windowså†…æ ¸</a>
              <a href="/tags/x64%E6%B1%87%E7%BC%96/" rel="tag"><i class="fa fa-tag"></i> x64æ±‡ç¼–</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/x64-Disassembly/" rel="prev" title="x64 å¸¸ç”¨æŒ‡ä»¤">
                  <i class="fa fa-chevron-left"></i> x64 å¸¸ç”¨æŒ‡ä»¤
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/x64-Disassembly3/" rel="next" title="x64 å¼‚å¸¸å¤„ç†">
                  x64 å¼‚å¸¸å¤„ç† <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 2018 â€“ 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Catecat</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">2m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">30:05</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1.15.0/dist/lozad.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  <script src="/js/local-search.js"></script>








<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  const url = element.dataset.target;
  const pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  const pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  const fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8.7.0/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>








  

  
      <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = '//cdn.jsdelivr.net/npm/mathjax@3.1.0/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({"enable":true,"appId":"7zujCcS8pYH88CJXfdBlLyS8-gzGzoHsz","appKey":"lWGr7OPoNHo4v1YmVV5yr3E9","serverURLs":"https://7zujccs8.lc-cn-n1-shared.com","placeholder":"å¿«æ¥å‹¾æ­æˆ‘å‘€ğŸ¶","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":true,"comment_count":true,"bg":"/images/comment_bg.png","recordIP":false,"enableQQ":false,"requiredFields":["nick"]}, {
      el: '#valine-comments',
      path: "/post/x64-Disassembly2/",
      serverURLs: "https://7zujccs8.lc-cn-n1-shared.com"
    }));
  }, window.Valine);
});
</script>

</body>
</html>
